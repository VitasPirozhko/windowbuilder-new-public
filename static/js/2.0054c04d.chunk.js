(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[2],{554:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=n(a(0)),s=(0,n(a(13)).default)(l.default.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft");t.default=s},560:function(e,t,a){"use strict";var n=a(0),l=a.n(n),s=(a(1),a(158)),o=a(206),r=a(160),i=a(524),c=a(545),h=a.n(c),d=a(554),m=a.n(d);class u extends l.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleOpen=e=>{this.setState({anchorEl:e.currentTarget})},this.handleClose=()=>{this.setState({anchorEl:null})}}render(){const{props:{items:e,Icon:t,text:a,handlePrint:n,prefix:c,variant:h},state:{anchorEl:d}}=this;return["button"===h?l.a.createElement(r.a,{key:"btn_open",onClick:this.handleOpen},l.a.createElement(t,null)):l.a.createElement(o.a,{key:c+"_open",onClick:this.handleOpen},t&&l.a.createElement(i.a,null,l.a.createElement(t,null)),a),l.a.createElement(s.a,{key:c+"_menu",open:Boolean(d),anchorEl:d,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},d&&e.map(e=>l.a.createElement(o.a,{key:e.ref,onClick:()=>{n(e),this.handleClose()}},e.name)))]}}class p extends u{constructor(...e){super(...e),this.state={anchorEl:null,plates:[]}}componentDidMount(){const{_mgr:e}=this.props.scheme.child_meta();e&&e.printing_plates().then(e=>{const t=new Map;for(const a in e){const n=e[a],l=n.name.includes("/")?n.name.substr(0,n.name.indexOf("/")).trim():"Общее";t.get(l)||t.set(l,[]),t.get(l).push(n)}e=[],t.forEach((t,a)=>e.push({name:a,value:t})),this.setState({plates:e})})}render(){const{props:{handlePrint:e,variant:t},state:{anchorEl:a,plates:n}}=this;return 1===n.length?l.a.createElement(u,{items:n[0].value,Icon:h.a,text:"Печать",handlePrint:e,prefix:"root",variant:t}):["button"===t?l.a.createElement(r.a,{key:"btn_open",onClick:this.handleOpen},l.a.createElement(h.a,null)):l.a.createElement(o.a,{key:"prn_open",onClick:this.handleOpen},l.a.createElement(i.a,null,l.a.createElement(h.a,null)),"Печать"),l.a.createElement(s.a,{key:"prn_menu",open:Boolean(a),anchorEl:a,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},a&&n.map((t,a)=>l.a.createElement(u,{key:"prn_"+a,items:t.value,Icon:m.a,text:t.name,handlePrint:e,prefix:"prn_"+a})))]}}p.propTypes={},t.a=p},561:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=n(a(0)),s=(0,n(a(13)).default)(l.default.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}),"AttachFile");t.default=s},562:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=n(a(0)),s=(0,n(a(13)).default)(l.default.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");t.default=s},586:function(e,t,a){"use strict";a.d(t,"b",(function(){return ae}));var n=a(0),l=a.n(n),s=a(1),o=a.n(s),r=a(552),i=a(334),c=a(522),h=a(530),d=a(536),m=a(520),u=a(85),p=a(210),_=a(750),f=a(119),b=a(244),E=a(115),y=a(161),g=a(147),v=a(337),C=a(22),k=a(36),j=a(7),S=a.n(j);function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}class w extends C.b{render(){const{props:{_obj:e,_fld:t,options:a,classes:n,extClasses:s,fullWidth:o,label_position:r,bar:i,className:c},_meta:h,onChange:d}=this,m={title:h.tooltip||h.synonym},u=e[t].valueOf();return l.a.createElement(g.a,O({className:s&&s.control?"":S()(n.formControl,c,i&&n.barInput),classes:s&&s.control?s.control:null,fullWidth:o},m),"hide"!=r&&l.a.createElement(y.a,{classes:s&&s.label?s.label:null},h.synonym),l.a.createElement(v.a,{native:!0,value:u,onChange:d,input:l.a.createElement(E.a,{classes:Object.assign({input:S()(n.input,m.required&&!u&&n.required)},s&&s.input)})},a.map((e,t)=>l.a.createElement("option",{key:t,value:e.valueOf()},e.toString()))))}}var D=Object(k.a)(w);var x=a(546),$=a(447),P=a(46),M=a(160),z=a(220),A=a.n(z),T=a(985),N=a.n(T),I=a(562),V=a.n(I),F=a(222),L=a.n(F),B=a(86);function U(e){return l.a.createElement($.a,{disableGutters:!0,className:e.classes.toolbar},!e.short&&l.a.createElement(M.a,{title:"Добавить",onClick:e.handleAdd},l.a.createElement(N.a,null)),l.a.createElement(M.a,{title:"Получить",onClick:e.handleDownload},l.a.createElement(A.a,null)),!e.short&&l.a.createElement(M.a,{title:"Удалить",onClick:e.handleDelete},l.a.createElement(V.a,null)),l.a.createElement(P.a,{variant:"h6",color:"inherit",className:e.classes.flex}," "),e.closeButton&&e.handleClose&&l.a.createElement(M.a,{title:"Закрыть форму",onClick:e.handleClose},l.a.createElement(L.a,null)))}U.propTypes={};var q=Object(B.a)(U),H=a(455),W=a(206),G=a(521),R=a(74),J=a(1046);function K(e){const{classes:t,_obj:a}=e,n=[];if(a._attachments)for(const s in a._attachments){const o=a._attachments[s];n.push(l.a.createElement(W.a,{key:s,className:t.menuItem,onClick:()=>e.handleSelect(s),onDoubleClick:()=>e.handleDownload(s)},l.a.createElement(J.a,{className:t.avatar},s.substr(s.lastIndexOf(".")+1,3)),l.a.createElement(G.a,{inset:!0,classes:{primary:t.primary,secondary:t.secondary},primary:s.substr(0,s.lastIndexOf(".")),secondary:`${(o.length/1e3).round(2)}Kb, ${o.content_type}`})))}else n.push(l.a.createElement(W.a,{key:"empty",className:t.menuItem},l.a.createElement(J.a,{className:t.avatar},"X"),l.a.createElement(G.a,{classes:{primary:t.primary},inset:!0,primary:"Нет вложенных файлов"})));return l.a.createElement(H.a,null,n)}K.propTypes={};var X=Object(R.a)(e=>({avatar:{margin:10},menuItem:{"&:focus":{backgroundColor:e.palette.primary.main,"& $primary, & $icon, & $secondary":{color:e.palette.common.white}}},primary:{},icon:{},secondary:{}}))(K),Q=a(159);function Y(){return(Y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}class Z extends r.a{constructor(e,t){super(e,t),this.fileChange=({target:e})=>{if(e.files.length){let t;const{_obj:n}=this.state,{utils:l,job_prm:s,msg:o}=$p;(l.mime_lookup?Promise.resolve():a.e(43).then(a.t.bind(null,1031,7)).then(e=>{e.default.constructor.call($p)})).then(()=>{for(let a=0;a<e.files.length;a++){const r=e.files[a];if(r.size>s.attachment_max_size)throw new Error(o.file_size+(s.attachment_max_size/1e6).round()+"Mb");t=t?t.then(()=>n.save_attachment(r.name,r,l.mime_lookup(r.name.substr(r.name.lastIndexOf(".")+1)))):n.save_attachment(r.name,r,l.mime_lookup(r.name.substr(r.name.lastIndexOf(".")+1)))}return t}).then(()=>n.load()).then(()=>this.forceUpdate()).catch(e=>{this.setState({dialog:{title:o.file_download,message:e.message}})})}},this.handleAdd=()=>{this.input&&this.input.click()},this.handleDelete=()=>{const{name:e}=this.state;e?this.setState({dialog:{title:"Удаление файла",name:e,message:`Удалить вложение "${e}"?`}}):this.setState({dialog:{title:$p.msg.file_download,message:$p.msg.file_select}})},this.handleDeleteFinish=()=>{const{name:e,_obj:t}=this.state;t.delete_attachment(e).then(()=>this.setState({dialog:null})).catch(e=>{this.setState({dialog:{title:$p.msg.file_download,message:e.message}})})},this.handleCloseDialog=()=>{this.setState({dialog:null})},this.handleSelect=e=>{this.setState({name:e})},this.handleDownload=()=>{const{name:e,_obj:t}=this.state;if(e){const a=`${t._manager.pouch_db.name}/${t.class_name}|${t.ref}/${e}`;window.open(a,"_blank")}else this.setState({dialog:{title:$p.msg.file_download,message:$p.msg.file_select}})},this.state={_obj:e._obj,dialog:null},this.input=null}render(){const{state:{_obj:e,dialog:t},context:a,props:n}=this,s={closeButton:!a.dnr,handleAdd:this.handleAdd,handleDelete:this.handleDelete,handleDownload:this.handleDownload,handleClose:n.handleClose},o={_obj:e,handleSelect:this.handleSelect,handleDownload:this.handleDownload};return e?[l.a.createElement("input",{key:"input",ref:e=>this.input=e,onChange:this.fileChange,type:"file",multiple:"1",style:{display:"none"}}),l.a.createElement(q,Y({key:"toolbar"},s)),l.a.createElement(X,Y({key:"data"},o)),t&&l.a.createElement(u.a,{key:"dialog",open:!0,title:t.title,onClose:this.handleCloseDialog,actions:t.name?[l.a.createElement(Q.a,{key:"cancel",onClick:this.handleCloseDialog,color:"primary"},"Отмена"),l.a.createElement(Q.a,{key:"ok",onClick:this.handleDeleteFinish,color:"primary"},"Ок")]:l.a.createElement(Q.a,{key:"ok",onClick:this.handleCloseDialog,color:"primary"},"Ок")},l.a.createElement(P.a,{color:"primary"},t.message))]:l.a.createElement(p.a,null)}}Z.propTypes={_obj:o.a.object,_mgr:o.a.object,_acl:o.a.string,match:o.a.object,read_only:o.a.object,handleClose:o.a.func,handleIfaceState:o.a.func};var ee=Z;function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ae(e,t){const{props:{_mgr:a,classes:n},state:{_obj:s,_meta:o}}=this;return e.map((e,a)=>{if(Array.isArray(e))return ae.call(this,e,t);const{element:r,fld:u,light:p,cond_value:_,items:E,...y}=e;if(s.is_folder&&u&&!["id","name","owner","parent"].includes(u))return null;switch(r){case"DataField":return l.a.createElement(f.a,te({key:"fld_"+a,_obj:s,_fld:u,_meta:o.fields[e.fld]},y));case"FieldSelect":return l.a.createElement(b.a,te({key:"fld_"+a,_obj:s,_fld:u,_meta:o.fields[e.fld]},y));case"FieldSelectStatic":return l.a.createElement(D,te({key:"fld_"+a,_obj:s,_fld:u,_meta:o.fields[e.fld]},y));case"FormGroup":return l.a.createElement(i.a,te({key:"grp_"+a,className:n.spaceLeft},y),ae.call(this,E,t));case"Divider":return l.a.createElement(c.a,{light:p,key:"dv_"+a});case"TabularSection":return l.a.createElement("div",{key:"ts_"+a,style:{height:320}},l.a.createElement(x.a,te({_obj:s,_tabular:u},y)));case"Tabs":return l.a.createElement(h.a,{position:"static",color:"default"},l.a.createElement(d.a,te({key:"tabs_"+a,value:s[u],onChange:this.handleValueChange(u)},y),ae.call(this,E,t)));case"Tab":return l.a.createElement(m.a,te({key:"tab_"+a,value:void 0!==_?_:a},y));case"Condition":return s[u]==_&&ae.call(this,E,t);default:const g=t&&t[r];return g?l.a.createElement(g,te({key:"fld_"+a,_obj:s,_fld:u,_meta:o.fields[e.fld]},y)):l.a.createElement("div",{key:a},r+": не реализовано в текущей версии")}})}class ne extends r.a{constructor(e,t){super(e,t),this.handlePrint=e=>{const{_obj:t}=this.state;t&&t._manager.print(t,e)},this.handleError=e=>{},this.onDataChange=(e,t)=>{($p.utils.is_tabular(e)&&e._owner._owner===this.state._obj||e===this.state._obj)&&this.shouldComponentUpdate(this.props)&&this.forceUpdate()};const{_mgr:a,_meta:n}=e;this._handlers={handleSave:this.handleSave.bind(this),handlePost:this.handlePost.bind(this),handleMarkDeleted:this.handleMarkDeleted.bind(this),handlePrint:this.handlePrint.bind(this),handleAttachments:this.handleAttachments.bind(this),handleCloseAttachments:this.handleCloseAttachments.bind(this),handleClose:this.handleClose.bind(this),handleSaveClose:this.handleSaveClose.bind(this)},this.state={_meta:n||a.metadata(),_obj:null,_attachments:!1}}componentDidMount(){const{_mgr:e,match:{params:t}}=this.props;(t.num&&e.by_num?e.by_num(t.num):e.get(t.ref,"promise")).then(e=>e.load_linked_refs()).then(t=>this.setState({_obj:t},()=>{const{onDataChange:t}=this;e.on({update:t,mixin:t,rows:t}),this.shouldComponentUpdate(this.props)})).catch(this.handleError)}componentWillUnmount(){const{onDataChange:e}=this;this.props._mgr.off({update:e,mixin:e,rows:e}),this.state._obj&&this.state._obj.is_new()&&this.state._obj.unload()}handlePost(){return this.handleSave(!0)}handleSave(e){const{_obj:t}=this.state;return t?t.save("boolean"===typeof e?e:void 0).then(()=>this.shouldComponentUpdate(this.props)).catch(e=>(this.props.handleIfaceState({component:"",name:"alert",value:{open:!0,title:t.presentation,text:e.reason||e.message}}),e)):Promise.resolve()}handleClose(){const{handlers:e,_mgr:t}=this.props,{_obj:a}=this.state,n="object"===typeof $p?$p.job_prm.base:"";e.handleNavigate(`${n||""}/${t.class_name}/list${a?"/?ref="+a.ref:""}`)}handleSaveClose(){this.handleSave().then(e=>"object"!==typeof e&&this.handleClose())}handleMarkDeleted(){}handleAttachments(){this.setState({_attachments:!0})}handleCloseAttachments(){this.setState({_attachments:!1})}handleValueChange(e){return(t,a)=>{const{state:{_obj:n},props:{handlers:l}}=this,s=n[e];n[e]=a||(t&&t.target?t.target.value:""),l.handleValueChange&&l.handleValueChange(e,s)}}renderFields(){const e=[],{struct:t}=this.props,{_meta:a,_obj:n}=this.state;if(!t){const t=["predefined_name"];n instanceof $p.classes.DocObj?e.push(l.a.createElement(i.a,{row:!0,key:"group_sys"},l.a.createElement(f.a,{_obj:n,key:"field_number_doc",_fld:"number_doc"}),l.a.createElement(f.a,{_obj:n,key:"field_date",_fld:"date"}))):n instanceof $p.classes.CatObj&&(a.code_length&&e.push(l.a.createElement(f.a,{_obj:n,key:"field_id",_fld:"id"})),a.main_presentation_name&&e.push(l.a.createElement(f.a,{_obj:n,key:"field_name",_fld:"name"})),a.has_owners&&(e.push(l.a.createElement(f.a,{_obj:n,key:"field_owner",_fld:"owner"})),t.push("owner")),a.hierarchical&&(e.push(l.a.createElement(f.a,{_obj:n,key:"field_parent",_fld:"parent"})),t.push("parent")));for(const s in a.fields)!t.includes(s)&&e.push(l.a.createElement(f.a,{fullWidth:!0,key:"field_"+s,_obj:n,_fld:s}))}return 0===e.length?null:l.a.createElement(i.a,null,e)}renderTabularSections(){const e=[],{_meta:t,_obj:a}=this.state;for(const n in t.tabular_sections)(e.length||Object.keys(t.fields).length)&&e.push(l.a.createElement(c.a,{light:!0,key:"dv_"+n})),e.push(l.a.createElement("div",{key:"ts_"+n,style:{height:300}},l.a.createElement(x.a,{_obj:a,_tabular:n})));return 0===e.length?null:l.a.createElement(i.a,null,e)}get ltitle(){const{_meta:e,_obj:t}=this.state;let a=t&&t.presentation||e.obj_presentation||e.synonym;return t&&t.is_folder&&(a+=" (Группа)"),t&&t._modified&&"*"!==a[a.length-1]&&(a+=" *"),a}get Toolbar(){return _.a}render(){const{props:{_mgr:e,classes:t},state:{_obj:a,_meta:n,_attachments:s},context:o,_handlers:r,Toolbar:c,denyDel:h,readOnly:d}=this,m=Object.assign({closeButton:!o.dnr,posted:a&&a.posted,deleted:a&&a.deleted,postable:!(!n.posted&&!e.metadata("posted")),deletable:!n.read_only&&!h&&!d,read_only:n.read_only||d,_obj:a},r);return a?[l.a.createElement(c,te({key:"toolbar"},m)),n.form&&n.form.obj&&n.form.obj.items?ae.call(this,n.form.obj.items,o.customComponents):l.a.createElement(i.a,{key:"data",className:t.spaceLeft},this.renderFields(),this.renderTabularSections()),s&&l.a.createElement(u.a,{key:"attachments",open:!0,noSpace:!0,title:`Вложения /${this.ltitle}/`,onClose:r.handleCloseAttachments},l.a.createElement(ee,{_obj:a,handleClose:r.handleCloseAttachments})),l.a.createElement("div",{key:"bottom",style:{marginBottom:8}})]:l.a.createElement(p.a,null)}}ne.propTypes={_mgr:o.a.object,_acl:o.a.string,_meta:o.a.object,match:o.a.object,classes:o.a.object,read_only:o.a.bool,handlers:o.a.object.isRequired};t.a=ne},750:function(e,t,a){"use strict";var n=a(0),l=a.n(n),s=(a(1),a(447)),o=a(46),r=a(160),i=a(159),c=a(158),h=a(206),d=a(560),m=a(738),u=a.n(m),p=a(984),_=a.n(p),f=a(601),b=a.n(f),E=a(222),y=a.n(E),g=a(215),v=a.n(g),C=a(561),k=a.n(C),j=a(86);a(7);class S extends n.Component{constructor(...e){super(...e),this.state={anchorEl:void 0,open:!1},this.handleClick=e=>{this.setState({open:!0,anchorEl:e.currentTarget})},this.handleRequestClose=()=>{this.setState({open:!1})}}render(){const{props:e}=this,t=e.showMenu||e.handleAttachments||e.handlePrint;return l.a.createElement(s.a,{disableGutters:!0,className:e.classes.toolbar},e.handleSaveClose&&!e.read_only&&l.a.createElement(i.a,{title:"Записать и закрыть",size:"small",variant:"outlined",className:e.classes.spaceLeft,onClick:e.handleSaveClose},"Записать и закрыть"),!e.read_only&&l.a.createElement(r.a,{title:"Записать",onClick:e.handleSave},l.a.createElement(u.a,null)),!e.read_only&&e.postable&&l.a.createElement(r.a,{title:e.posted?"Отменить проведение":"Провести",onClick:()=>e.handleSave(!e.posted)},l.a.createElement(_.a,null)),!e.read_only&&e.deletable&&l.a.createElement(r.a,{title:e.deleted?"Снять пометку удаления":"Пометить на удаление",onClick:e.handleMarkDeleted},l.a.createElement(b.a,null)),e.buttons,l.a.createElement(o.a,{variant:"h6",color:"inherit",className:e.classes.flex}," "),t&&l.a.createElement(r.a,{onClick:this.handleClick,title:"Дополнительно"},l.a.createElement(v.a,null)),l.a.createElement(c.a,{anchorEl:this.state.anchorEl,open:this.state.open,onClose:this.handleRequestClose},e.handlePrint&&l.a.createElement(d.a,{scheme:{child_meta:()=>({_mgr:e._obj._manager})},handlePrint:t=>e.handlePrint(t)}),e.handleAttachments&&l.a.createElement(h.a,{onClick:e.handleAttachments},l.a.createElement(k.a,null),"  Вложения"),e.menu_buttons),e.closeButton&&l.a.createElement(r.a,{title:"Закрыть форму",onClick:e.handleClose},l.a.createElement(y.a,null)))}}S.propTypes={},t.a=Object(j.a)(S)},984:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=n(a(0)),s=(0,n(a(13)).default)(l.default.createElement("path",{d:"M16.59 7.58L10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"CheckCircleOutline");t.default=s},985:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=n(a(0)),s=(0,n(a(13)).default)(l.default.createElement("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"}),"CloudUpload");t.default=s}}]);
//# sourceMappingURL=2.0054c04d.chunk.js.map