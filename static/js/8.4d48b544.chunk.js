(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[8,19],{1043:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),i=r(740),o=r(130),s=r(20),l=r(972),c=r.n(l),u=r(613),d=r(1010),p=r(975),f=r.n(p),h=r(976),m=r.n(h),y=r(74),v=r(7),g=r.n(v);class b extends a.a.Component{constructor(...e){super(...e),this.state={selected:""}}render(){const{classes:e,hidden:t,height:r,reverseHide:n,handleNavigate:i,imgs:o}=this.props,{selected:s}=this.state;return a.a.createElement("div",{className:e.root,style:{minHeight:r}},a.a.createElement(d.a,{size:"small",className:e.fab,onClick:n,style:{top:t?-16:0},title:t?"Показать эскизы":"Скрыть эскизы"},t?a.a.createElement(f.a,null):a.a.createElement(m.a,null)),!t&&o.map(({ref:e,svg:t})=>{const r=()=>i("/builder/"+e);return a.a.createElement("div",{key:e,className:g()({rsvg_elm:!0,rsvg_selected:e===s}),ref:e=>{e&&(e.innerHTML=$p.iface.scale_svg(t,88,22),e.firstChild.ondblclick=r)},onClick:()=>this.setState({selected:e}),onDoubleClick:r})}))}}var _=Object(y.a)(e=>({root:{width:"100%",position:"relative",paddingTop:2,maxHeight:180},fab:{position:"absolute",top:e.spacing(),right:e.spacing(2)}}),{withTheme:!0})(b);const O=new Map;O.set(!0,24),O.set(!1,90);class w extends n.Component{constructor(e,t){super(e,t),this.handleRowSelect=({selectedRow:e})=>{this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{if(e&&this.prev_ref!==e.ref){if(this.state.hidden)return this.prev_ref=e.ref;const t=[];if($p.utils.is_data_obj(e))e.production.forEach(({characteristic:{ref:e,svg:r}})=>{r&&t.push({ref:e,svg:r})}),this.prev_ref=e.ref,this.setState({imgs:t});else{const{doc:r}=$p.adapters.pouch.local;r.get("doc.calc_order|"+e.ref).then(({production:e})=>(e&&e.forEach(({characteristic:e})=>{!$p.utils.is_empty_guid(e)&&t.push("cat.characteristics|"+e)}),t.length?r.allDocs({keys:t,limit:t.length,include_docs:!0}):{rows:t})).then(({rows:e})=>(e.forEach(({id:e,doc:r})=>{if(r&&r.svg){const n=t.indexOf(e);t[n]={ref:e.substr(20),svg:r.svg}}}),t.filter(e=>e.svg))).then(t=>{this.prev_ref=e.ref,this.setState({imgs:t})}).catch($p.record_log)}}else this.prev_ref="",this.setState({imgs:[]})},300)},this.reverseHide=()=>{const e=!this.state.hidden;$p.wsql.set_user_param("svgs_area_hidden",e),this.setState({hidden:e},()=>{if(!e&&this.prev_ref){const{prev_ref:e}=this;this.prev_ref="",this.handleRowSelect({selectedRow:{ref:e}})}})},this.handlers=Object.assign({},this.props.handlers,{handleSchemeChange:u.b.bind(this)}),this.state={hidden:$p.wsql.get_user_param("svgs_area_hidden","boolean"),imgs:[]},this.timer=0,this.prev_ref=""}render(){const{props:{windowHeight:e,windowWidth:t,location:r},state:{hidden:n,imgs:o},handlers:s}=this,l={windowHeight:e,windowWidth:t,height:(e>480?e-51:428)-O.get(n),width:t>800?t-(e<480?20:0):800},u=c.a.parse(r.search.replace("?",""));return[a.a.createElement(i.default,Object.assign({key:"list",_mgr:$p.doc.calc_order,_acl:"e",_ref:u.ref,handlers:s,onRowSelect:this.handleRowSelect,indexer:!0,show_search:!0},l)),a.a.createElement(_,{key:"svgs",hidden:n,imgs:o,height:O.get(n)-2,reverseHide:this.reverseHide,handleNavigate:s.handleNavigate})]}}w.rname="CalcOrderList";t.default=Object(o.a)(Object(s.withObj)(w))},554:function(e,t,r){"use strict";var n=r(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(0)),i=(0,n(r(13)).default)(a.default.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft");t.default=i},560:function(e,t,r){"use strict";var n=r(0),a=r.n(n),i=(r(1),r(158)),o=r(206),s=r(160),l=r(524),c=r(545),u=r.n(c),d=r(554),p=r.n(d);class f extends a.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleOpen=e=>{this.setState({anchorEl:e.currentTarget})},this.handleClose=()=>{this.setState({anchorEl:null})}}render(){const{props:{items:e,Icon:t,text:r,handlePrint:n,prefix:c,variant:u},state:{anchorEl:d}}=this;return["button"===u?a.a.createElement(s.a,{key:"btn_open",onClick:this.handleOpen},a.a.createElement(t,null)):a.a.createElement(o.a,{key:c+"_open",onClick:this.handleOpen},t&&a.a.createElement(l.a,null,a.a.createElement(t,null)),r),a.a.createElement(i.a,{key:c+"_menu",open:Boolean(d),anchorEl:d,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},d&&e.map(e=>a.a.createElement(o.a,{key:e.ref,onClick:()=>{n(e),this.handleClose()}},e.name)))]}}class h extends f{constructor(...e){super(...e),this.state={anchorEl:null,plates:[]}}componentDidMount(){const{_mgr:e}=this.props.scheme.child_meta();e&&e.printing_plates().then(e=>{const t=new Map;for(const r in e){const n=e[r],a=n.name.includes("/")?n.name.substr(0,n.name.indexOf("/")).trim():"Общее";t.get(a)||t.set(a,[]),t.get(a).push(n)}e=[],t.forEach((t,r)=>e.push({name:r,value:t})),this.setState({plates:e})})}render(){const{props:{handlePrint:e,variant:t},state:{anchorEl:r,plates:n}}=this;return 1===n.length?a.a.createElement(f,{items:n[0].value,Icon:u.a,text:"Печать",handlePrint:e,prefix:"root",variant:t}):["button"===t?a.a.createElement(s.a,{key:"btn_open",onClick:this.handleOpen},a.a.createElement(u.a,null)):a.a.createElement(o.a,{key:"prn_open",onClick:this.handleOpen},a.a.createElement(l.a,null,a.a.createElement(u.a,null)),"Печать"),a.a.createElement(i.a,{key:"prn_menu",open:Boolean(r),anchorEl:r,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},r&&n.map((t,r)=>a.a.createElement(f,{key:"prn_"+r,items:t.value,Icon:p.a,text:t.name,handlePrint:e,prefix:"prn_"+r})))]}}h.propTypes={},t.a=h},561:function(e,t,r){"use strict";var n=r(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(0)),i=(0,n(r(13)).default)(a.default.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}),"AttachFile");t.default=i},613:function(e,t,r){"use strict";function n(e){const{current_user:t}=$p;if(t){if(e._data._inited)return;e._data._inited=!0,t.branch.empty()?a("obj_delivery_state",[],e):a("manager",[t.ref],e,"cat.users")}}function a(e,t,r,n){const{selection:a}=r||this.props.scheme||{};if(!a)return;let i=a.find({left_value:e});if(i||(i=a.add({left_value:e})),t.length){if(i.use=!0,i.left_value_type="path",i.right_value_type=n||this[e]._mgr.class_name,"obj_delivery_state"===e){const e=[];for(const r of t)"draft"===r?(e.push("Черновик"),e.push("Отозван")):"sent"===r?e.push("Отправлен"):"confirmed"===r?e.push("Подтвержден"):"declined"===r?e.push("Отклонен"):"template"===r&&e.push("Шаблон");t=e}t.length>1?(i.comparison_type="in",i.right_value=t.join()):(i.comparison_type="eq",i.right_value=t[0])}else i.use=!1}r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}))},740:function(e,t,r){"use strict";r.r(t);var n=r(603);t.default=n.a},744:function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),i=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)"undefined"!==typeof e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:i,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var a=t[n],i=a.obj[a.prop],o=Object.keys(i),s=0;s<o.length;++s){var l=o[s],c=i[l];"object"===typeof c&&null!==c&&-1===r.indexOf(c)&&(t.push({obj:i,prop:l}),r.push(c))}return function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var n=[],a=0;a<t.length;++a)"undefined"!==typeof t[a]&&n.push(t[a]);r.obj[r.prop]=n}}return t}(t)},decode:function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},encode:function(e){if(0===e.length)return e;for(var t="string"===typeof e?e:String(e),r="",n=0;n<t.length;++n){var i=t.charCodeAt(n);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?r+=t.charAt(n):i<128?r+=a[i]:i<2048?r+=a[192|i>>6]+a[128|63&i]:i<55296||i>=57344?r+=a[224|i>>12]+a[128|i>>6&63]+a[128|63&i]:(n+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(n)),r+=a[240|i>>18]+a[128|i>>12&63]+a[128|i>>6&63]+a[128|63&i])}return r},isBuffer:function(e){return null!==e&&"undefined"!==typeof e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,a){if(!r)return t;if("object"!==typeof r){if(Array.isArray(t))t.push(r);else{if("object"!==typeof t)return[t,r];(a.plainObjects||a.allowPrototypes||!n.call(Object.prototype,r))&&(t[r]=!0)}return t}if("object"!==typeof t)return[t].concat(r);var o=t;return Array.isArray(t)&&!Array.isArray(r)&&(o=i(t,a)),Array.isArray(t)&&Array.isArray(r)?(r.forEach((function(r,i){n.call(t,i)?t[i]&&"object"===typeof t[i]?t[i]=e(t[i],r,a):t.push(r):t[i]=r})),t):Object.keys(r).reduce((function(t,i){var o=r[i];return n.call(t,i)?t[i]=e(t[i],o,a):t[i]=o,t}),o)}}},745:function(e,t,r){"use strict";var n=String.prototype.replace,a=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,a,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},972:function(e,t,r){"use strict";var n=r(973),a=r(974),i=r(745);e.exports={formats:i,parse:a,stringify:n}},973:function(e,t,r){"use strict";var n=r(744),a=r(745),i={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},o=Date.prototype.toISOString,s={delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,serializeDate:function(e){return o.call(e)},skipNulls:!1,strictNullHandling:!1},l=function e(t,r,a,i,o,l,c,u,d,p,f,h){var m=t;if("function"===typeof c)m=c(r,m);else if(m instanceof Date)m=p(m);else if(null===m){if(i)return l&&!h?l(r,s.encoder):r;m=""}if("string"===typeof m||"number"===typeof m||"boolean"===typeof m||n.isBuffer(m))return l?[f(h?r:l(r,s.encoder))+"="+f(l(m,s.encoder))]:[f(r)+"="+f(String(m))];var y,v=[];if("undefined"===typeof m)return v;if(Array.isArray(c))y=c;else{var g=Object.keys(m);y=u?g.sort(u):g}for(var b=0;b<y.length;++b){var _=y[b];o&&null===m[_]||(v=Array.isArray(m)?v.concat(e(m[_],a(r,_),a,i,o,l,c,u,d,p,f,h)):v.concat(e(m[_],r+(d?"."+_:"["+_+"]"),a,i,o,l,c,u,d,p,f,h)))}return v};e.exports=function(e,t){var r=e,o=t?n.assign({},t):{};if(null!==o.encoder&&void 0!==o.encoder&&"function"!==typeof o.encoder)throw new TypeError("Encoder has to be a function.");var c="undefined"===typeof o.delimiter?s.delimiter:o.delimiter,u="boolean"===typeof o.strictNullHandling?o.strictNullHandling:s.strictNullHandling,d="boolean"===typeof o.skipNulls?o.skipNulls:s.skipNulls,p="boolean"===typeof o.encode?o.encode:s.encode,f="function"===typeof o.encoder?o.encoder:s.encoder,h="function"===typeof o.sort?o.sort:null,m="undefined"!==typeof o.allowDots&&o.allowDots,y="function"===typeof o.serializeDate?o.serializeDate:s.serializeDate,v="boolean"===typeof o.encodeValuesOnly?o.encodeValuesOnly:s.encodeValuesOnly;if("undefined"===typeof o.format)o.format=a.default;else if(!Object.prototype.hasOwnProperty.call(a.formatters,o.format))throw new TypeError("Unknown format option provided.");var g,b,_=a.formatters[o.format];"function"===typeof o.filter?r=(b=o.filter)("",r):Array.isArray(o.filter)&&(g=b=o.filter);var O,w=[];if("object"!==typeof r||null===r)return"";O=o.arrayFormat in i?o.arrayFormat:"indices"in o?o.indices?"indices":"repeat":"indices";var j=i[O];g||(g=Object.keys(r)),h&&g.sort(h);for(var E=0;E<g.length;++E){var k=g[E];d&&null===r[k]||(w=w.concat(l(r[k],k,j,u,d,p?f:null,b,h,m,y,_,v)))}var x=w.join(c),C=!0===o.addQueryPrefix?"?":"";return x.length>0?C+x:""}},974:function(e,t,r){"use strict";var n=r(744),a=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:n.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},o=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,o=/(\[[^[\]]*])/.exec(n),s=o?n.slice(0,o.index):n,l=[];if(s){if(!r.plainObjects&&a.call(Object.prototype,s)&&!r.allowPrototypes)return;l.push(s)}for(var c=0;null!==(o=i.exec(n))&&c<r.depth;){if(c+=1,!r.plainObjects&&a.call(Object.prototype,o[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(o[1])}return o&&l.push("["+n.slice(o.index)+"]"),function(e,t,r){for(var n=t,a=e.length-1;a>=0;--a){var i,o=e[a];if("[]"===o)i=(i=[]).concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,l=parseInt(s,10);!isNaN(l)&&o!==s&&String(l)===s&&l>=0&&r.parseArrays&&l<=r.arrayLimit?(i=[])[l]=n:i[s]=n}n=i}return n}(l,t,r)}};e.exports=function(e,t){var r=t?n.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!==typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"===typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:i.delimiter,r.depth="number"===typeof r.depth?r.depth:i.depth,r.arrayLimit="number"===typeof r.arrayLimit?r.arrayLimit:i.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"===typeof r.decoder?r.decoder:i.decoder,r.allowDots="boolean"===typeof r.allowDots?r.allowDots:i.allowDots,r.plainObjects="boolean"===typeof r.plainObjects?r.plainObjects:i.plainObjects,r.allowPrototypes="boolean"===typeof r.allowPrototypes?r.allowPrototypes:i.allowPrototypes,r.parameterLimit="number"===typeof r.parameterLimit?r.parameterLimit:i.parameterLimit,r.strictNullHandling="boolean"===typeof r.strictNullHandling?r.strictNullHandling:i.strictNullHandling,""===e||null===e||"undefined"===typeof e)return r.plainObjects?Object.create(null):{};for(var s="string"===typeof e?function(e,t){for(var r={},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=t.parameterLimit===1/0?void 0:t.parameterLimit,s=n.split(t.delimiter,o),l=0;l<s.length;++l){var c,u,d=s[l],p=d.indexOf("]="),f=-1===p?d.indexOf("="):p+1;-1===f?(c=t.decoder(d,i.decoder),u=t.strictNullHandling?null:""):(c=t.decoder(d.slice(0,f),i.decoder),u=t.decoder(d.slice(f+1),i.decoder)),a.call(r,c)?r[c]=[].concat(r[c]).concat(u):r[c]=u}return r}(e,r):e,l=r.plainObjects?Object.create(null):{},c=Object.keys(s),u=0;u<c.length;++u){var d=c[u],p=o(d,s[d],r);l=n.merge(l,p,r)}return n.compact(l)}},975:function(e,t,r){"use strict";var n=r(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(0)),i=(0,n(r(13)).default)(a.default.createElement("path",{d:"M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp");t.default=i},976:function(e,t,r){"use strict";var n=r(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(0)),i=(0,n(r(13)).default)(a.default.createElement("path",{d:"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown");t.default=i}}]);
//# sourceMappingURL=8.4d48b544.chunk.js.map