{"version":3,"sources":["components/CalcOrder/Jalousie/SelectProduct.js","components/CalcOrder/Jalousie/SelectMaterial.js","components/CalcOrder/Jalousie/Prop.js","components/CalcOrder/Jalousie/Props.js","components/CalcOrder/Jalousie/Additions.js","components/CalcOrder/Jalousie/index.js","components/CalcOrder/Jalousie/Parametric.js","components/CalcOrder/Additions/AdditionsItem.js","components/CalcOrder/Additions/connect.js","components/CalcOrder/Additions/styles.js","components/CalcOrder/Additions/Frame.js","../node_modules/metadata-react/DataField/stylesPropertyGrid.js"],"names":["useStyles","makeStyles","theme","formControl","margin","spacing","select","display","img","width","SelectProduct","foroomApi","product","setProduct","classes","open","setOpen","React","useState","init_data","foroom_pics_url","params","FormControl","className","fullWidth","InputLabel","Select","onClose","onOpen","value","onChange","event","target","selectMenu","all_data","izd","filter","v","enabled","map","i","MenuItem","key","ListItemIcon","src","icom","icon","ListItemText","primary","nameRu","secondary","name","ptype","height","backgroundSize","backgroundPosition","marginRight","SelectMaterial","setProp","materials","ost","tid","style","backgroundImage","icos","withStyles","prop","props","ext","extClasses","typ","startsWith","control","disabled","includes","label","native","alias","input","Input","options","val","_meta","synonym","FieldNumber","_obj","_fld","handleValueChange","ProductProps","Typography","variant","filter_params","id","color","calc","catalogs","stamp","Date","now","data","Additions","Component","state","price","length","material","this","setState","HTMLElement","nprops","Object","assign","setOrder","cat","doc","current_user","responsible","$p","ref","cmd","dialog","res","Promise","resolve","supplier","http_apis","by_name","empty","is_new","calc_order","get","organization","department","orders","calc_order_row","invoice_row","find","is_supplier","add","invoice","then","purchase_order","create","load","goods","goods_row","nom_characteristic","characteristic","nom","unit","storage_unit","quantity","origin","identifier","ids","split","category","prms","JSON","parse","hasOwnProperty","amount","e","forceUpdate","componentDidMount","adapters","pouch","fetch","text","code","script","document","createElement","type","getElementsByTagName","appendChild","window","default","visible","deleted","json","debug","account","price_margin","discounts","console_mode","nodejs_mode","destination","init","init_calc","engine","catch","err","handleCalck","tmpl","subtype","load_template","current_item","calcPrice","error","ui","dialogs","alert","title","errors","p","prm","join","cx","stringify","utils","_mixin","convert_item_to_preview","x","y","s","note","prod_name","len","first_cost","value_change","wnd","_modified","set_text","presentation","production","elmnts","grids","refresh_row","save","render","LoadingMessage","Grid","container","direction","justify","alignItems","item","xs","md","component","Props","Parametric","Frame","Content","AdditionsItem","dp","meta","scheme","tref","onRowUpdated","onCellSelected","minHeight","TabularSection","_tabular","hideToolbar","ItemData","inserts","fill_data","items","enm","inserts_types","additions_groups","buyers_order","by_ref","components","Map","forEach","set","product_params","_data","_loading","find_rows","ordn","blank","guid","row","indexOf","insert_type","cmp","elm","count","param","inset","clr","ProductionRow","fill_schemas","docs","schemas","handleAdd","tabular","find_inset","call","group","_owner","Параметрик","rowGetter","setTimeout","_grid","selectCell","rowIdx","idx","msg","show_msg","handleRemove","selectedRow","del","onSelect","_inset","choice_params","metadata","fields","path","prototype","push","reduce","curr","next","priority","compose","connect","additions","process_add_product_list","sync_grid","handleCancel","handlers","handleIfaceState","entered","marginTop","groupTitle","fontWeight","listitem","paddingTop","paddingBottom","ParametricFrame","constructor","context","super","handleOk","message","handleErrClose","queryClose","bind","actions","initFullScreen","large","onClick","ok","calck","el","obj","toLowerCase","shrink","lshrink","lformControl","root","iroot","checkbox","transform","top","left","position","marginLeft","minWidth","paddingRight","borderBottom","borderRadius"],"mappings":"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","file":"static/js/18.553ea4cf.chunk.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  formControl: {\r\n    margin: theme.spacing(),\r\n  },\r\n  select: {\r\n    display: 'contents',\r\n  },\r\n  img: {\r\n    width: 120,\r\n    margin: -theme.spacing(),\r\n  }\r\n}));\r\n\r\nexport default function SelectProduct({foroomApi, product, setProduct}) {\r\n\r\n  const classes = useStyles();\r\n  const [open, setOpen] = React.useState(!product);\r\n\r\n  const handleChange = event => {\r\n    setProduct(event.target.value);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setOpen(false);\r\n  };\r\n\r\n  const handleOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  const {init_data, foroom_pics_url} = foroomApi.params;\r\n\r\n  return <FormControl className={classes.formControl} fullWidth>\r\n    <InputLabel>Изделие</InputLabel>\r\n    <Select\r\n      open={open}\r\n      onClose={handleClose}\r\n      onOpen={handleOpen}\r\n      value={product}\r\n      onChange={handleChange}\r\n      classes={product ? {selectMenu: classes.select} : null}\r\n    >\r\n      {\r\n        init_data.all_data.izd\r\n          .filter((v) => v.enabled)\r\n          .map((v, i) => <MenuItem key={`izd-${i}`} value={v} >\r\n            <ListItemIcon>\r\n              <img className={classes.img} src={`${foroom_pics_url}${v.icom || v.icon}`} />\r\n            </ListItemIcon>\r\n            <ListItemText primary={v.nameRu} secondary={`${v.name} ${v.ptype}`} />\r\n          </MenuItem>)\r\n      }\r\n    </Select>\r\n  </FormControl>;\r\n}\r\n\r\nSelectProduct.propTypes = {\r\n  foroomApi: PropTypes.object,\r\n  product: PropTypes.object,\r\n  setProduct: PropTypes.func,\r\n};\r\n\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  formControl: {\r\n    margin: theme.spacing(),\r\n  },\r\n  img: {\r\n    width: 92,\r\n    height: 92,\r\n    backgroundSize: 'cover',\r\n    backgroundPosition: 'center',\r\n    marginRight: theme.spacing(),\r\n  },\r\n  select: {\r\n    display: 'contents',\r\n  }\r\n}));\r\n\r\nexport default function SelectMaterial({foroomApi, product, value, setProp}) {\r\n\r\n  const classes = useStyles();\r\n\r\n  const handleChange = event => {\r\n    setProp(event.target.value);\r\n  };\r\n\r\n  const {foroom_pics_url} = foroomApi.params;\r\n\r\n  return <FormControl className={classes.formControl} fullWidth>\r\n    <InputLabel>Материал</InputLabel>\r\n    <Select\r\n      value={value}\r\n      onChange={handleChange}\r\n      classes={value ? {selectMenu: classes.select} : null}\r\n    >\r\n      {\r\n        product.materials\r\n          .filter((v) => v.ost > 0)\r\n          .map((v, i) => <MenuItem key={`mt-${i}`} value={v.tid}>\r\n            <ListItemIcon>\r\n              <span className={classes.img} style={{backgroundImage: `url(${foroom_pics_url}${v.icos || v.icon})`}} />\r\n            </ListItemIcon>\r\n            <ListItemText primary={v.name} />\r\n          </MenuItem>)\r\n      }\r\n    </Select>\r\n  </FormControl>;\r\n}\r\n\r\nSelectMaterial.propTypes = {\r\n  foroomApi: PropTypes.object,\r\n  product: PropTypes.object,\r\n  value: PropTypes.string,\r\n  setProp: PropTypes.func,\r\n};\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport Input from '@material-ui/core/Input';\r\nimport withStyles, {extClasses} from 'metadata-react/DataField/stylesPropertyGrid';\r\nimport FieldNumber from 'metadata-react/DataField/FieldNumber';\r\n\r\nfunction Prop({classes, prop, props, setProp}) {\r\n  const ext = extClasses(classes);\r\n  if(prop.typ.startsWith('radio')) {\r\n    return <FormControl classes={ext.control} fullWidth disabled={prop.typ.includes('disabled')}>\r\n      <InputLabel classes={ext.label}>{prop.name}</InputLabel>\r\n      <Select\r\n        native\r\n        value={props[prop.alias]}\r\n        onChange={setProp}\r\n        input={<Input classes={ext.input}/>}\r\n      >\r\n        {prop.options.map((v, key) => <option key={key} value={v.val}>{v.name}</option>)}\r\n      </Select>\r\n    </FormControl>;\r\n  }\r\n  else {\r\n    const _meta = {synonym: prop.name};\r\n    return <FieldNumber _obj={props} _fld={prop.alias} _meta={_meta} handleValueChange={setProp} extClasses={ext} fullWidth/>;\r\n  }\r\n}\r\n\r\nProp.propTypes = {\r\n  classes: PropTypes.object,\r\n  prop: PropTypes.object,\r\n  props: PropTypes.object,\r\n  setProp: PropTypes.func,\r\n};\r\n\r\nexport default withStyles(Prop);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Prop from './Prop';\r\n\r\nfunction ProductProps({foroomApi, product, props, setProp}) {\r\n\r\n  if(!product) {\r\n    return <Typography variant=\"subtitle1\" color=\"secondary\">Не выбрано изделие</Typography>;\r\n  }\r\n\r\n  return <div>\r\n    <Typography variant=\"subtitle1\">Параметры</Typography>\r\n    {product.params\r\n      .filter(foroomApi.filter_params)\r\n      .map((v, i) => <Prop key={`${product.id}-${i}`} prop={v} props={props} setProp={setProp(v.alias)}/>)}\r\n  </div>;\r\n}\r\n\r\nProductProps.propTypes = {\r\n  foroomApi: PropTypes.object,\r\n  product: PropTypes.object,\r\n  props: PropTypes.object,\r\n  setProp: PropTypes.func,\r\n};\r\n\r\nexport default ProductProps;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport LoadingMessage from 'metadata-react/DumbLoader/LoadingMessage';\r\nimport SelectProduct from './SelectProduct';\r\nimport SelectMaterial from './SelectMaterial';\r\nimport Props from './Props';\r\n\r\nlet foroomApi;\r\nlet calc;\r\n\r\nconst catalogs = {\r\n  stamp: Date.now(),\r\n  data: null,\r\n};\r\n\r\nconst load_data = () => {\r\n  if(catalogs.data && Date.now() - catalogs.stamp < 36e5) {\r\n    return Promise.resolve(catalogs.data);\r\n  }\r\n  return $p.adapters.pouch.fetch(`/adm/api/foroom`)\r\n    .then((res) => res.json())\r\n    .then((data) => {\r\n      Object.assign(catalogs, {data, stamp: Date.now()});\r\n      return data;\r\n    });\r\n};\r\n\r\nconst load_script = () => {\r\n  return $p.adapters.pouch.fetch(`/adm/api/foroom/js`)\r\n    .then((res) => res.text())\r\n    .then((code) => {\r\n      //create a dom element to hold the code\r\n      const script = document.createElement('script');\r\n      script.type = 'text/javascript';\r\n      //set the script tag text, including the debugger id at the end!!\r\n      script.text = code + `\\n////# sourceURL=/adm/api/foroom/js\\n`;\r\n      //append the code to the dom\r\n      document.getElementsByTagName('head')[0].appendChild(script);\r\n      foroomApi = window.foroomApi.default;\r\n      foroomApi.filter_params = function (v) {\r\n        return v.visible && v.enabled && !v.deleted && !['gab_width', 'gab_height'].includes(v.alias);\r\n      };\r\n    });\r\n};\r\n\r\nclass Additions extends React.Component {\r\n\r\n  state = {product: null, props: {}, price: 0};\r\n\r\n  // при необходимости, создаёт и дозаполняет заказ поставщику\r\n  setOrder() {\r\n    const {cat, doc, current_user: responsible} = $p;\r\n    const {ref, cmd} = this.props.dialog;\r\n    let res = Promise.resolve();\r\n\r\n    this.supplier = cat.http_apis.by_name('FOROOM');\r\n    if(this.supplier.empty() || this.supplier.is_new()) {\r\n      throw 'empty supplier';\r\n    }\r\n    this.calc_order = doc.calc_order.get(ref);\r\n    const {organization, department, orders} = this.calc_order;\r\n    this.calc_order_row = cmd;\r\n    this.invoice_row = orders.find({is_supplier: this.supplier});\r\n    if(!this.invoice_row) {\r\n      this.invoice_row = orders.add({is_supplier: this.supplier});\r\n    }\r\n    if(this.invoice_row.invoice.empty()) {\r\n      res = res.then(() => doc.purchase_order.create({responsible, organization, department}))\r\n        .then((invoice) => {\r\n          this.invoice_row.invoice = invoice;\r\n        });\r\n    }\r\n    else if(this.invoice_row.invoice.is_new()) {\r\n      res = res.then(() => this.invoice_row.invoice.load());\r\n    }\r\n\r\n    return res\r\n      .then(() => {\r\n        const {goods} = this.invoice_row.invoice;\r\n        this.goods_row = goods.find({nom_characteristic: this.calc_order_row.characteristic});\r\n        if(!this.goods_row) {\r\n          this.goods_row = goods.add({\r\n            calc_order: this.calc_order,\r\n            nom: this.calc_order_row.nom,\r\n            nom_characteristic: this.calc_order_row.characteristic,\r\n            unit: this.calc_order_row.nom.storage_unit,\r\n            quantity: this.calc_order_row.quantity,\r\n          });\r\n        }\r\n        this.calc_order_row.characteristic.origin = this.invoice_row.invoice;\r\n\r\n        // восстанавливаем параметры\r\n        const {identifier, params} = this.goods_row;\r\n        if(identifier && params) {\r\n          const ids = identifier.split('|');\r\n          const product = foroomApi.params.init_data.all_data.izd.find(\r\n            ({tid, ptype, category}) => tid == ids[0] && ptype == ids[1] && category == ids[2]);\r\n          if(product) {\r\n            try {\r\n              const props = {};\r\n              const prms = JSON.parse(params);\r\n              for(const prop of product.params) {\r\n                if(foroomApi.filter_params(prop)) {\r\n                  if(prms.hasOwnProperty(prop.alias)) {\r\n                    props[prop.alias] = prms[prop.alias];\r\n                  }\r\n                  else if(prop.alias === 'amount') {\r\n                    props.amount = this.calc_order_row.quantity;\r\n                  }\r\n                  else if(prop.typ.startsWith('radio')) {\r\n                    props[prop.alias] = prop.options[0] ? prop.options[0].val : prop.val;\r\n                  }\r\n                  else {\r\n                    props[prop.alias] = prop.val;\r\n                  }\r\n                }\r\n              }\r\n              if(prms.material) {\r\n                props.material = prms.material;\r\n              }\r\n              else if(product.materials.length) {\r\n                props.material = product.materials[0].tid;\r\n              }\r\n              return this.setState({product, props, price: this.calc_order_row.price});\r\n            }\r\n            catch (e) {}\r\n          }\r\n        }\r\n        this.forceUpdate();\r\n      });\r\n  }\r\n\r\n  componentDidMount() {\r\n\r\n    Promise.resolve()\r\n      .then(() => {\r\n        return foroomApi || load_script()\r\n          .then(() => this.forceUpdate());\r\n      })\r\n      .then(() => {\r\n        return calc || load_data()\r\n          .then((init_data) => {\r\n            const params = {\r\n              debug: true,\r\n              account: {\r\n                price_margin: 1,  // наценка на прайс-лист\r\n                discounts: [],    // дискаунты аккаунта (оставляйте пустым, если не хотите чтобы ядро посчитало цены с неправильными скидками)\r\n              },\r\n              init_data,          // вот тут можно отдать справочники ядру\r\n              console_mode: true, // дополняет неосновные параметры шаблона значениями по умолчанию, если они отсутсвуют. считаем его deprecated\r\n              nodejs_mode: false, // это чтобы в логи лишнее не выводил, при работе через NodeJS\r\n              destination: 'sfr', // sfr - позволяет работать со всеми изделиями и материалами, доступными в нашей системе sale.foroom\r\n            };\r\n            foroomApi.init(params);\r\n            foroomApi.init_calc((engine) => {\r\n              calc = engine;\r\n              this.forceUpdate();\r\n            });\r\n          });\r\n      })\r\n      .then(() => {\r\n        this.setOrder();\r\n      })\r\n      .catch((err) => null); /* eslint-disable-line */\r\n  }\r\n\r\n  handleCalck() {\r\n    const {product, props} = this.state;\r\n    const tmpl = Object.assign({}, props, {\r\n      type: product.ptype,\r\n      subtype: product.category,\r\n    });\r\n\r\n    calc.load_template(tmpl);  // загружаем изделие\r\n    calc.current_item.calcPrice(); // расчитываем его\r\n    if (calc.current_item.error) {\r\n      const {params} = product;\r\n      $p.ui.dialogs.alert({\r\n        title: 'Ошибка расчета жалюзи',\r\n        text: calc.current_item.errors.map((p) => {\r\n          const prm = params.find((v) => v.alias === p);\r\n          return prm ? prm.name : p;\r\n        }).join(', ')});\r\n    }\r\n    else {\r\n      const {goods_row, calc_order_row} = this;\r\n      const {characteristic: cx} = calc_order_row;\r\n\r\n      // тут будет изделие, которое можно запустить в работу, если ошибок нет\r\n      //data.items.push(calc.current_item.release());\r\n      // тут будут расписаны все параметры (очень удобно формировать из этого приложения к договору)\r\n      //data.items_rus.push(calc.convert_item_to_preview(tmpl));\r\n\r\n      goods_row.price = calc.current_item.price;\r\n      goods_row.quantity = tmpl.amount || 1;\r\n      goods_row.params = JSON.stringify($p.utils._mixin({}, tmpl, [], ['amount','type','subtype']));\r\n      goods_row.identifier = `${product.tid}|${product.ptype}|${product.category}`;\r\n\r\n      const {material, name} = calc.convert_item_to_preview(tmpl);\r\n      cx.x = tmpl.width;\r\n      cx.y = tmpl.height;\r\n      cx.s = cx.x * cx.y / 1e6;\r\n      cx.note = `${name.val}/${material.val}`;\r\n      cx.name = cx.prod_name();\r\n\r\n      Object.assign(calc_order_row._obj, {\r\n        len: cx.x,\r\n        width: cx.y,\r\n        s: cx.s,\r\n        first_cost: calc.current_item.price,\r\n      });\r\n      calc_order_row.value_change('quantity', '', goods_row.quantity);\r\n\r\n      const {wnd} = this.props.dialog;\r\n      this.calc_order._modified = true;\r\n      wnd.set_text(this.calc_order.presentation);\r\n\r\n      const {production} = wnd.elmnts.grids;\r\n      production.refresh_row(calc_order_row);\r\n      this.setState({price: calc_order_row.price});\r\n    }\r\n\r\n    return this.invoice_row.invoice.save();\r\n  }\r\n\r\n  setProduct = (product) => {\r\n    const props = {};\r\n    for(const prop of product.params) {\r\n      if(foroomApi.filter_params(prop)) {\r\n        if(prop.typ.startsWith('radio')) {\r\n          props[prop.alias] = prop.options[0] ? prop.options[0].val : prop.val;\r\n        }\r\n        else {\r\n          props[prop.alias] = prop.val;\r\n        }\r\n      }\r\n    }\r\n    if(product.materials.length) {\r\n      props.material = product.materials[0].tid;\r\n    }\r\n    this.setState({product, props, price: 0});\r\n  };\r\n\r\n  setProp = (name) => {\r\n    return (value) => {\r\n      const {props} = this.state;\r\n      if(value && value.target instanceof HTMLElement) {\r\n        value = value.target.value;\r\n      }\r\n      const nprops = Object.assign({}, props, {[name]: value});\r\n      this.setState({props: nprops, price: 0});\r\n    };\r\n  };\r\n\r\n  render() {\r\n    if(!foroomApi) {\r\n      return <LoadingMessage text=\"Загрузка библиотеки...\"/>;\r\n    }\r\n    if(!catalogs.data) {\r\n      return <LoadingMessage text=\"Подготовка данных...\"/>;\r\n    }\r\n    if(!this.goods_row) {\r\n      return <LoadingMessage text=\"Чтение заказа...\"/>;\r\n    }\r\n    const {product, props, price} = this.state;\r\n    return <Grid\r\n      container\r\n      direction=\"row\"\r\n      justify=\"space-between\"\r\n      alignItems=\"flex-start\"\r\n      spacing ={3}\r\n    >\r\n        <Grid item xs={12} md={4}>\r\n          <SelectProduct foroomApi={foroomApi} product={product} setProduct={this.setProduct} />\r\n          {product && <SelectMaterial foroomApi={foroomApi} product={product} value={props.material}  setProp={this.setProp('material')}/>}\r\n          <div>\r\n            <Typography component=\"span\" variant=\"h4\">Цена: </Typography>\r\n            <Typography component=\"span\" variant={price ? 'h4' : 'h6'} color=\"secondary\">{price || 'Не рассчитана'}</Typography>\r\n            {price ? <Typography component=\"span\" variant=\"h4\"> ₽</Typography> : null}\r\n          </div>\r\n        </Grid>\r\n        <Grid item xs={12} md={8}>\r\n          <Props foroomApi={foroomApi} product={product} props={props} setProp={this.setProp}/>\r\n        </Grid>\r\n      </Grid>;\r\n  }\r\n}\r\n\r\nAdditions.propTypes = {\r\n  dialog: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default Additions;\r\n","import Parametric from './Parametric';\r\n\r\nexport default Parametric;\r\n","/**\r\n * ### Форма редактирования параметрических изделий\r\n *\r\n * Created by Evgeniy Malyarov on 22.07.2019.\r\n */\r\n\r\nimport React from 'react';\r\nimport Frame from '../Additions/Frame';\r\nimport Additions from './Additions';\r\n\r\nexport default function Parametric(props) {\r\n  return <Frame Content={Additions} title=\"Жалюзи\" {...props} />;\r\n}\r\n","/**\r\n * ### Форма добавления услуг и комплектуюущих\r\n * Абстрактная строка допвставки - от неё наследуются строки подоконников, отливов и т.д.\r\n *\r\n * Created by Evgeniy Malyarov on 13.11.2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\n//import {FormGroup} from '@material-ui/core/Form';\r\nimport TabularSection from 'metadata-react/TabularSection';\r\n\r\nexport default class AdditionsItem extends Component {\r\n\r\n  render() {\r\n    const {dp, meta, scheme, tref, onRowUpdated, onCellSelected, minHeight} = this.props;\r\n\r\n    return <TabularSection\r\n      ref={tref}\r\n      _obj={dp}\r\n      _meta={meta}\r\n      _tabular=\"production\"\r\n      scheme={scheme}\r\n      onRowUpdated={onRowUpdated}\r\n      onCellSelected={onCellSelected}\r\n      minHeight={minHeight}\r\n      hideToolbar\r\n    />;\r\n  }\r\n\r\n}\r\n\r\nAdditionsItem.propTypes = {\r\n  dp: PropTypes.object.isRequired,\r\n  scheme: PropTypes.object.isRequired,\r\n  meta: PropTypes.object.isRequired,\r\n  tref: PropTypes.func.isRequired,\r\n  onRowUpdated: PropTypes.func.isRequired,\r\n  onCellSelected: PropTypes.func.isRequired,\r\n  minHeight: PropTypes.number,\r\n};\r\n","/**\r\n * ### Форма добавления услуг и комплектуюущих\r\n * обработчики событий и модификаторы данных\r\n *\r\n * Created by Evgeniy Malyarov on 13.11.2017.\r\n */\r\n\r\nimport {connect} from 'react-redux';\r\nimport withStyles from './styles';\r\nimport {compose} from 'redux';\r\n\r\nimport AdditionsItem from './AdditionsItem';\r\nconst {ItemData} = $p.cat.inserts;\r\n\r\n\r\n// заполняет компонент данными\r\nexport function fill_data(ref, items) {\r\n\r\n  if(!items) {\r\n    items = this.items = $p.enm.inserts_types.additions_groups;\r\n  }\r\n  const dp = this.dp = $p.dp.buyers_order.create();\r\n  dp.calc_order = $p.doc.calc_order.by_ref[ref];\r\n  const components = this.components = new Map();\r\n  items.forEach(v => components.set(v, new ItemData(v, AdditionsItem)));\r\n\r\n  const {production, product_params} = dp;\r\n\r\n  // фильтруем по пустой ведущей продукции\r\n  dp._data._loading = true;\r\n  dp.calc_order.production.find_rows({ordn: $p.utils.blank.guid}, (row) => {\r\n    const {characteristic} = row;\r\n    const {origin} = characteristic;\r\n    // фильтруем по типу вставки\r\n    if(!characteristic.empty() && origin && !origin.empty() && items.indexOf(origin.insert_type) != -1) {\r\n      const cmp = components.get(origin.insert_type);\r\n      // добавляем параметры\r\n      const elm = production.count() + 1;\r\n      characteristic.params.forEach(({param, value}) => {\r\n        product_params.add({elm, param, value});\r\n      });\r\n      // добавляем строку продукции\r\n      production.add({\r\n        characteristic,\r\n        inset: origin,\r\n        clr: characteristic.clr,\r\n        len: row.len,\r\n        height: row.width,\r\n        quantity: row.quantity,\r\n        note: row.note,\r\n      }, false, cmp.ProductionRow);\r\n      // счетчик строк данного типа\r\n      cmp.count++;\r\n    }\r\n  });\r\n  dp._data._loading = false;\r\n}\r\n\r\n// заполняет соответствие схем и типов вставок в state компонента\r\nexport function fill_schemas(docs = []) {\r\n  const schemas = new Map();\r\n  for (const doc of docs) {\r\n    for (const item of this.items) {\r\n      if(item && doc.name == item.name) {\r\n        schemas.set(item, doc);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  this.setState({schemas});\r\n}\r\n\r\nexport function handleAdd() {\r\n  const {tabular, props} = this;\r\n  const inset = find_inset.call(this, props.group);\r\n  if(inset && tabular) {\r\n    const {_data} = tabular.state._tabular._owner;\r\n    _data._loading = true;\r\n    const row = tabular.state._tabular.add({inset, quantity: 1}, false, props.ProductionRow);\r\n    _data._loading = false;\r\n    row.value_change('inset', 'force', row.inset);\r\n    this.setState({\r\n      count: this.state.count + 1,\r\n    });\r\n\r\n    //selectRow\r\n    if(inset.insert_type == $p.enm.inserts_types.Параметрик) {\r\n      for(let i = 0; i < row.row; i++) {\r\n        if(tabular.rowGetter(i) === row) {\r\n          setTimeout(() => tabular._grid.selectCell({rowIdx: i, idx: 0}, true));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  else {\r\n    $p.msg.show_msg({\r\n      type: 'alert-info',\r\n      text: `Нет вставки подходящего типа (${props.group})`,\r\n      title: 'Новая строка'\r\n    });\r\n  }\r\n}\r\n\r\nexport function handleRemove() {\r\n  const {props, tabular, state, selectedRow} = this;\r\n  if(tabular && selectedRow){\r\n    const {calc_order_row} = selectedRow.characteristic;\r\n    selectedRow._owner.del(selectedRow);\r\n    this.selectedRow = null;\r\n    tabular.forceUpdate();\r\n    if(state.count) {\r\n      this.setState({\r\n        count: state.count - 1,\r\n      });\r\n    }\r\n    if(calc_order_row){\r\n      calc_order_row._owner.del(calc_order_row);\r\n    }\r\n    props.onSelect && props.onSelect(null);\r\n  }\r\n  else{\r\n    $p.msg.show_msg({\r\n      type: 'alert-info',\r\n      text: `Укажите строку для удаления (${props.group})`,\r\n      title: 'Удаление строки'\r\n    });\r\n  }\r\n}\r\n\r\n\r\n// ищет первую, наиболее приоритетную вставку данного типа\r\nexport function find_inset(insert_type) {\r\n  if(!this._inset) {\r\n    const {choice_params} = $p.dp.buyers_order.metadata('production').fields.inset;\r\n    const filter = {insert_type};\r\n    choice_params && choice_params.forEach(({name, path}) => {\r\n      if(name === 'insert_type') {\r\n        return;\r\n      }\r\n      if(Object.prototype.hasOwnProperty.call(filter, name)) {\r\n        filter[name] = [filter[name]];\r\n        filter[name].push(path);\r\n      }\r\n      else {\r\n        filter[name] = path;\r\n      }\r\n    });\r\n    this._inset = $p.cat.inserts.find_rows(filter)\r\n      .reduce((curr, next) => curr && curr.priority >= next.priority ? curr : next, null);\r\n  }\r\n  return this._inset;\r\n}\r\n\r\nfunction mapStateToProps(state, props) {\r\n  return {\r\n    handleCalck() {\r\n      const {additions} = this;\r\n      const {dp} = additions;\r\n      return dp ?\r\n        dp.calc_order.process_add_product_list(dp)\r\n          .then(() => {\r\n            dp.calc_order.production.sync_grid(props.dialog.wnd.elmnts.grids.production);\r\n          })\r\n        :\r\n        additions.handleCalck();\r\n    },\r\n    handleCancel() {\r\n      props.handlers.handleIfaceState({\r\n        component: 'DataObjPage',\r\n        name: 'dialog',\r\n        value: null,\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n// function mapDispatchToProps(dispatch) {\r\n//   return {};\r\n// }\r\n\r\nexport default compose(\r\n  withStyles,\r\n  connect(mapStateToProps /*, mapDispatchToProps */),\r\n);\r\n","/**\r\n * ### Форма добавления услуг и комплектуюущих\r\n * стили оформления\r\n *\r\n * Created by Evgeniy Malyarov on 13.11.2017.\r\n */\r\n\r\nimport {withStyles} from '@material-ui/styles';\r\n\r\nconst styles = theme => ({\r\n  entered: {\r\n    minHeight: 120,\r\n  },\r\n  secondary: {\r\n    marginTop: -theme.spacing(1.5),\r\n  },\r\n  groupTitle: {\r\n    fontWeight: 'bold',\r\n  },\r\n  listitem: {\r\n    paddingTop: theme.spacing(),\r\n    paddingBottom: theme.spacing(),\r\n  }\r\n});\r\n\r\nexport default withStyles(styles);\r\n","/**\r\n * ### Диалог редактирования параметрических изделий\r\n *\r\n * @module Frame\r\n *\r\n * Created by Evgeniy Malyarov on 22.07.2019.\r\n */\r\n\r\nimport React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from 'metadata-react/App/Dialog';\r\n\r\nimport connect from './connect';\r\n\r\nclass ParametricFrame extends React.Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    const {handleCancel} = props;\r\n    this.handleCancel = handleCancel.bind(this);\r\n    this.state = {msg: null, queryClose: false};\r\n  }\r\n\r\n  handleOk = () => {\r\n    this.props.handleCalck.call(this)\r\n      .then(this.handleCancel)\r\n      .catch((err) => {\r\n        this.setState({msg: err.msg || err.message});\r\n      });\r\n  };\r\n\r\n  handleCalck = () => {\r\n    this.props.handleCalck.call(this)\r\n      .catch((err) => {\r\n        this.setState({msg: err.msg});\r\n      });\r\n  };\r\n\r\n  handleErrClose = () => {\r\n    this.setState({msg: null, queryClose: false});\r\n  };\r\n\r\n  queryClose = () => {\r\n    this.setState({queryClose: true});\r\n  };\r\n\r\n  render() {\r\n\r\n    const {handleCancel, handleErrClose, props: {dialog, title, actions, Content}, state: {msg, queryClose}} = this;\r\n\r\n    return <Dialog\r\n      open\r\n      initFullScreen\r\n      large\r\n      title={title}\r\n      onClose={this.queryClose}\r\n      actions={[\r\n        !actions && <Button key=\"ok\" onClick={this.handleOk} color=\"primary\">Рассчитать и закрыть</Button>,\r\n        actions && actions.ok && <Button key=\"ok\" onClick={this.handleOk} color=\"primary\">{actions.ok}</Button>,\r\n        !actions && <Button key=\"calck\" onClick={this.handleCalck} color=\"primary\">Рассчитать</Button>,\r\n        actions && actions.calck && <Button key=\"calck\" onClick={this.handleCalck} color=\"primary\">{actions.calck}</Button>,\r\n        <Button key=\"cancel\" onClick={handleCancel} color=\"primary\">Закрыть</Button>\r\n      ]}\r\n    >\r\n      <Content ref={(el) => this.additions = el} dialog={dialog}/>\r\n      {msg && <Dialog\r\n        open\r\n        title={msg.title || 'Ошибка при записи'}\r\n        onClose={handleErrClose}\r\n        actions={[\r\n          <Button key=\"ok\" onClick={handleErrClose} color=\"primary\">Ок</Button>,\r\n        ]}\r\n      >\r\n        {msg.obj && <div>{msg.obj.name}</div>}\r\n        {msg.text || msg}\r\n      </Dialog>}\r\n      {queryClose && <Dialog\r\n        open\r\n        title={`Закрыть ${title.toLowerCase()}?`}\r\n        onClose={handleErrClose}\r\n        actions={[\r\n          <Button key=\"ok\" onClick={handleCancel} color=\"primary\">Ок</Button>,\r\n          <Button key=\"cancel\" onClick={handleErrClose} color=\"primary\">Отмена</Button>\r\n        ]}\r\n      >\r\n        Внесённые изменения будут потеряны\r\n      </Dialog>}\r\n    </Dialog>;\r\n\r\n  }\r\n}\r\n\r\nParametricFrame.propTypes = {\r\n  Content: PropTypes.oneOfType([PropTypes.object, PropTypes.func]).isRequired,\r\n  title: PropTypes.string.isRequired,\r\n  dialog: PropTypes.object.isRequired,\r\n  actions: PropTypes.object,\r\n  handlers: PropTypes.object.isRequired,\r\n  handleCalck: PropTypes.func.isRequired,\r\n  handleCancel: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connect(ParametricFrame);\r\n","/**\n * Стилизация DataField под PropertyGrid\n *\n * @module stylesPropertyGrid\n *\n * Created by Evgeniy Malyarov on 19.02.2020.\n */\nimport { withStyles } from '@material-ui/styles';\n\nconst styles = theme => ({\n  lshrink: {\n    transform: 'translate(0, 12px)'\n  },\n  lformControl: {\n    top: 0,\n    left: 0,\n    position: 'absolute',\n    transform: 'translate(0, 12px)'\n  },\n  iroot: {\n    marginLeft: '40%',\n    'label + &': {\n      marginTop: 0\n    }\n  },\n  control: {\n    minWidth: 300,\n    paddingRight: theme.spacing(),\n    paddingTop: 2,\n    borderBottom: '1px solid #e8e8e8'\n  },\n  checkbox: {\n    borderRadius: 'unset'\n  }\n});\n\nexport const extClasses = classes => ({\n  label: {\n    shrink: classes.lshrink,\n    formControl: classes.lformControl\n  },\n  input: {\n    root: classes.iroot\n  },\n  control: {\n    root: classes.control\n  },\n  checkbox: {\n    root: classes.checkbox\n  }\n});\nexport default withStyles(styles);"],"sourceRoot":""}