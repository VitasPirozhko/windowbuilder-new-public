(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[27],{1034:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(159),o=a(85),c=a(739),l=a(1014),i=a(1011),d=a(1012),m=a(46),p=a(546);class h extends r.a.Component{constructor(e,t){super(e,t),$p.cat.scheme_settings.find_rows({obj:"dp.buyers_order.production"},e=>{e.name.endsWith("select_prod")&&(this.scheme=e)})}rowSelection(){const{production:e}=this.props.dp;return{showCheckbox:!0,enableShiftSelect:!0,selectBy:{keys:{rowKey:"row",markKey:"use",values:e.find_rows({use:!0}).map(e=>e.row)}}}}render(){const{dp:e}=this.props;return this.scheme?r.a.createElement(p.a,{_obj:e,_tabular:"production",scheme:this.scheme,rowSelection:this.rowSelection(),denyAddDel:!0,hideToolbar:!0}):r.a.createElement(m.a,{key:"err-nom",color:"error"},'Не найден элемент scheme_settings {obj: "dp.buyers_order.production", name: "production.select_prod"}')}}var u=h,f=a(334),g=a(517),y=a(518),_=a(119);const b=Object(c.a)(e=>({group:{alignItems:"flex-end",paddingBottom:e.spacing()},synonim:{paddingBottom:e.spacing(),width:180},switch:{width:170}}));function k({classes:e,checked:t,handleChange:a,dp:n,fld:s,title:o}){return r.a.createElement(f.a,{row:!0,className:e.group},r.a.createElement(m.a,{className:e.synonim},o),r.a.createElement(g.a,{className:e.switch,control:r.a.createElement(y.a,{checked:t,onChange:a,name:s}),label:t?"Установить":"Не изменять"}),r.a.createElement(_.a,{_obj:n,_fld:s,read_only:!t}))}function E({dp:e}){const t=b(),[a,n]=r.a.useState({sys:e.use_sys,furn:e.use_furn,inset:e.use_inset,clr:e.use_clr}),s=({target:t})=>{n({...a,[t.name]:t.checked}),e["use_"+t.name]=t.checked};return r.a.createElement(f.a,null,r.a.createElement(k,{classes:t,checked:a.sys,handleChange:s,dp:e,fld:"sys",title:"Система профилей:"}),r.a.createElement(k,{classes:t,checked:a.clr,handleChange:s,dp:e,fld:"clr",title:"Цвет:"}),r.a.createElement(k,{classes:t,checked:a.furn,handleChange:s,dp:e,fld:"furn",title:"Фурнитура:"}),r.a.createElement(k,{classes:t,checked:a.inset,handleChange:s,dp:e,fld:"inset",title:"Заполнения:"}))}var w=a(634);var v=Object(w.a)((function({classes:e,...t}){return r.a.createElement(_.a,Object.assign({extClasses:Object(w.b)(e),fullWidth:!0,isTabular:!1},t))}));class C extends r.a.Component{constructor(e,t){super(e,t);const{production:a,product_params:n}=e.dp,r=new Map,s=[];a.forEach(e=>{e.use&&e.characteristic.params.find_rows({hide:!1},({param:e,value:t})=>{!e.caption||!e.show_calculated&&e.is_calculated||(r.get(e)||r.set(e,new Set),r.get(e).add(t))})});for(const[e,t]of r)1===t.size&&s.push({param:e,value:Array.from(t)[0]});s.sort((e,t)=>e.sorting_field>t.sorting_field?1:e.sorting_field<t.sorting_field?-1:e.name>t.name?1:e.name<t.name?-1:0),n.load(s)}render(){const{product_params:e}=this.props.dp,{fields:t}=e._owner._metadata(e._name),a=[],n={selection:{}};let s;return e.forEach(e=>{const{param:o}=e;let c,l=!1;try{c=o.params_links({grid:n,obj:e})}catch(e){c=[]}l||(l=c.length?c.some(e=>e.hide):e.hide);const i=Object.assign({},t.value);i.synonym=o.caption||o.name;const{types:d}=o.type;let m=1===d.length&&"cat.property_values"===d[0];if(c.length){const t=[];o.linked_values(c,e,t)&&(s=!0),t.length&&(t.length<50&&(m=!0),i.choice_params||(i.choice_params=[]),i.choice_params.push({name:"ref",path:{in:t.map(e=>e.value)}}))}e.hide!==l&&(e.hide=l,s=!0),l||a.push(r.a.createElement(v,{key:"prm-"+e.row,_obj:e,_fld:"value",_meta:i,ctrl_type:m?"oselect":void 0}))}),a}}var j=C;const x=Object(c.a)(e=>({root:{width:"100%"},backButton:{marginRight:e.spacing()},instructions:{marginTop:e.spacing(),marginBottom:e.spacing()},cont:{minHeight:320,marginBottom:e.spacing()}}));function S({setReady:e,...t}){const a=x(),[n,o]=r.a.useState(0),c=["Выбор изделий","Основные свойства","Дополнительные свойства"];return r.a.createElement("div",{className:a.root},r.a.createElement(l.a,{activeStep:n,alternativeLabel:!0},c.map(e=>r.a.createElement(i.a,{key:e},r.a.createElement(d.a,null,e)))),r.a.createElement("div",null,r.a.createElement("div",{className:a.cont},function(e,t){switch(e){case 0:return r.a.createElement(u,t);case 1:return r.a.createElement(E,t);case 2:return r.a.createElement(j,t);default:return"Unknown stepIndex"}}(n,t)),r.a.createElement("div",null,r.a.createElement(s.a,{disabled:0===n,onClick:()=>{o(e=>e-1),e(!1)},className:a.backButton},"Назад"),r.a.createElement(s.a,{disabled:n===c.length-1,variant:"contained",color:"primary",onClick:()=>{o(e=>e+1),e(n===c.length-2)}},"Далее"))))}class B extends r.a.Component{constructor(e,t){const{ref:a,_mgr:n}=e.dialog;super(e,t),this.setReady=e=>{this.setState({ready:e})},this.handleCalck=()=>{const{dialog:{ref:e,cmd:t,_mgr:a}}=this.props;$p.ui.dialogs.alert({title:"Пересчет с заменой параметров",text:"Не релизовано"}),this.handleCancel()},this.handleCancel=()=>{this.props.handlers.handleIfaceState({component:"DataObjPage",name:"dialog",value:null})},this.state={ready:!1},this.obj=n.get(a);const r=this.dp=$p.dp.buyers_order.create();r.production.load(this.obj.production),r.production.forEach(e=>{const{characteristic:t}=e;e.use=t.coordinates.count(),r.sys.empty()&&!t.sys.empty()&&(r.sys=t.sys),r.clr.empty()&&t.coordinates.find_rows({elm_type:$p.enm.elm_types.Рама},e=>{if(!e.clr.empty())return r.clr=e.clr,!1}),r.furn.empty()&&t.constructions.forEach(e=>{if(!e.furn.empty())return r.furn=e.furn,!1}),r.inset.empty()&&t.glasses.find_rows({is_sandwich:!1},({elm:e})=>{const a=t.coordinates.find({elm:e});if(a)return r.inset=a.inset,!1})})}render(){const{state:{ready:e},dp:t,obj:a}=this;return r.a.createElement(o.a,{open:!0,initFullScreen:!0,large:!0,title:"Пересчет с заменой параметров",onClose:this.handleCancel,actions:[r.a.createElement(s.a,{key:"ok",disabled:!e,onClick:this.handleCalck,variant:"contained",color:"primary"},"Выполнить"),r.a.createElement(s.a,{key:"cancel",onClick:this.handleCancel,color:"primary"},"Отмена")]},r.a.createElement(S,{setReady:this.setReady,dp:t,obj:a}))}}var O=B;t.default=O},634:function(e,t,a){"use strict";a.d(t,"b",(function(){return r}));var n=a(74);const r=e=>({label:{shrink:e.lshrink,formControl:e.lformControl},input:{root:e.iroot},control:{root:e.control},checkbox:{root:e.checkbox}});t.a=Object(n.a)(e=>({lshrink:{transform:"translate(0, 12px)"},lformControl:{top:0,left:0,position:"absolute",transform:"translate(0, 12px)"},iroot:{marginLeft:"40%","label + &":{marginTop:0}},control:{minWidth:300,paddingRight:e.spacing(),paddingTop:2,borderBottom:"1px solid #e8e8e8"},checkbox:{borderRadius:"unset"}}))}}]);
//# sourceMappingURL=27.c13040d4.chunk.js.map