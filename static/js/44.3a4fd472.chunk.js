(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[44],{751:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),l=a(1),r=a.n(l),o=a(552),h=a(210),i=a(447),c=a(46),d=a(160),m=a(159),p=a(158),u=a(206),g=a(215),b=a.n(g),_=a(545),w=a.n(_),S=a(602),E=a.n(S),x=a(220),C=a.n(x),f=a(628),R=a.n(f),j=a(606),y=a(604),O=a(607),D=a(86);class v extends n.Component{constructor(e,t){super(e,t),this.handleChange=()=>{this.props.handleSchemeChange(this.props.scheme)},this.state={anchorEl:void 0,menuOpen:!1},j.b.call(this)}render(){const{props:e,state:t,handleChange:a}=this,{handleSave:n,handleClose:l,handlePrint:r,_obj:o,_tabular:h,classes:g,scheme:_,settings_open:S,ToolbarExt:x}=e;return s.a.createElement(i.a,{disableGutters:!0,className:g.toolbar},s.a.createElement(m.a,{size:"small",onClick:n,disabled:S},s.a.createElement("i",{className:"fa fa-play fa-fw"})," Сформировать"),!_.standard_period.empty()&&s.a.createElement(d.a,{disabled:!0},"|"),!_.standard_period.empty()&&s.a.createElement(O.a,{_obj:_,_fld:"date",_meta:{synonym:"Период"},classes:g,handleChange:a}),x&&s.a.createElement(x,null),s.a.createElement(c.a,{color:"inherit",className:g.flex}," "),s.a.createElement(y.a,{handleSettingsOpen:e.handleSettingsOpen,handleSettingsClose:e.handleSettingsClose,handleSchemeChange:e.handleSchemeChange,settings_open:S,classes:g,scheme:_,show_variants:!0}),s.a.createElement(d.a,{onClick:this.handleMenuOpen,title:"Дополнительно"},s.a.createElement(b.a,null)),s.a.createElement(p.a,{anchorEl:t.anchorEl,open:t.menuOpen,onClose:this.handleMenuClose},s.a.createElement(u.a,{disabled:!0,onClick:r},s.a.createElement(w.a,null),"  Печать"),s.a.createElement(u.a,{onClick:this.handleExportCSV},s.a.createElement(E.a,null),"  Копировать CSV"),s.a.createElement(u.a,{onClick:this.handleExportJSON},s.a.createElement(C.a,null),"  Копировать JSON"),s.a.createElement(u.a,{onClick:this.handleExportXLS},s.a.createElement(R.a,null),"  Экспорт в XLS")))}}v.propTypes={};var k=Object(D.a)(v),T=a(582),P=a.n(T);class H extends n.Component{constructor(e,t){super(e,t),this.getRows=e=>this.state.rows[e],this.onRowExpandToggle=e=>{const t=Object.assign({},this.state.expanded);t[e.columnGroupName]=Object.assign({},t[e.columnGroupName]),t[e.columnGroupName][e.row]={isExpanded:e.shouldExpand},this.setState({expanded:t})},this.onCellExpand=e=>{let t=this.state.rows.slice(0),a=e.rowData.row,n=t.indexOf(e.rowData),s=e.expandArgs.children,l=Object.assign({},this.state.expanded);l&&!l[a]?(l[a]=!0,this.updateSubRowDetails(s,e.rowData.treeDepth),t.splice(n+1,0,...s)):l[a]&&(l[a]=!1,t.splice(n+1,s.length)),this.setState({expanded:l,rows:t})},this.getSubRowDetails=e=>{const{_columns:t}=this.props,{key:a}=t[0];let n=!!this.state.expanded[e.row]&&this.state.expanded[e.row];return{group:e.children&&e.children.length>0,expanded:n,children:e.children,field:a,treeDepth:e.treeDepth||0,siblingIndex:e.siblingIndex,numberSiblings:e.numberSiblings}},this.RowRenderer=({renderBaseRow:e,...t})=>{let a;const{scheme:n}=this.props;return n.conditional_appearance.find_rows({use:!0},n=>{if(n.check(t.row)){try{a=s.a.createElement("div",{style:JSON.parse(n.css)},e(t))}catch(e){}return!1}}),a||e(t)},this.updateSubRowDetails=(e,t)=>{let a=t||0;e.forEach((t,n)=>{t.treeDepth=a+1,t.siblingIndex=n,t.numberSiblings=e.length,t.children&&this.updateSubRowDetails(t.children,t.treeDepth)})};const{_obj:a,_tabular:n,_meta:l}=e;this.state={_meta:l||a._metadata(n),rows:[],expanded:{}}}shouldComponentUpdate({scheme:e}){if(e!==this.props.scheme){const{_obj:e,_tabular:t}=this.props,a=e[t];a&&a.count()&&(a._rows&&(a._rows.length=a._rows._count=0),a.clear()),this.state.rows.length=0,this.state.expanded={}}return!0}expandRoot(){const{_obj:e,_tabular:t,scheme:a}=this.props,n=a.dims(),s=e[t]._rows||[];if(s.length&&n.length){const e=s.slice(0),t=s[0].children;e.splice(1,0,...t),this.updateSubRowDetails(t,1),this.setState({expanded:{0:!0},rows:e})}else this.setState({expanded:{},rows:s})}expandAll(e=0){const t=this.props.scheme.dims(),{expanded:a,rows:n}=this.state;if(n.length&&t.length){const e=n.slice(0);n.slice(0).forEach((t,n)=>{if(t._level||!t.children||a[t.row])return;const s=t.children;e.splice(e.indexOf(t)+1,0,...s),this.updateSubRowDetails(s,1),a[t.row]=!0}),this.setState({expanded:a,rows:e})}}render(){const{props:e,state:t,RowRenderer:a}=this,{_columns:n,minHeight:l,hideHeader:r}=e;return s.a.createElement(P.a,{columns:n,enableCellSelect:!0,rowGetter:this.getRows,rowsCount:t.rows.length,getSubRowDetails:this.getSubRowDetails,onCellExpand:this.onCellExpand,minHeight:l||220,rowHeight:33,headerRowHeight:r?1:33,rowRenderer:a})}}H.propTypes={};var N=a(572),G=a(218),J=a(20);class I extends o.a{constructor(e,t){super(e,t),this.handleSave=()=>{const{_obj:e,scheme:t}=this.state;return t&&!t.empty()?(e.scheme!==t&&(e.scheme=t),e.calculate().then(()=>this._result.expandRoot())):Promise.reject(new Error("Пустая схема компоновки"))},this.handlePrint=()=>{},this.handleClose=()=>{},this.handleSettingsOpen=()=>{this.setState({settings_open:!0})},this.handleSettingsClose=()=>{this.setState({settings_open:!1})},this.handleSchemeChange=e=>{const{props:t,state:{_obj:a,_meta:n}}=this,{handleSchemeChange:s,handleColumns:l,read_only:r}=t,o=e.rx_columns({mode:"ts",fields:n.fields,_obj:a,read_only:r});l&&l(o),s&&s(this,e),this.setState({scheme:e,_columns:o},()=>this.shouldComponentUpdate(t))};const{_mgr:a,_meta:n,_obj:s}=e,l=e._tabular||a._tabular||"data";this.state={_obj:s||a.create(),_meta:n||a.metadata(l),_tabular:l,settings_open:!1},(e.scheme?Promise.resolve(e.scheme):$p.cat.scheme_settings.get_scheme(a.class_name+"."+l)).then(this.handleSchemeChange).then(()=>{e.autoexec&&Promise.resolve().then(()=>this.handleSave())}),e.registerRep&&e.registerRep(this)}get ltitle(){const{_mgr:e}=this.props,{scheme:t}=this.state;return e.metadata().synonym+(t&&t.name?` (${t.name})`:"")}render(){const{props:e,state:t}=this,{_obj:a,_columns:n,_tabular:l,scheme:r,settings_open:o}=t,{RepParams:i}=a._manager;if(!r)return s.a.createElement(h.a,{text:"Чтение настроек компоновки..."});if(!a)return s.a.createElement(h.a,{text:"Чтение объекта данных..."});if(!n||!n.length)return s.a.createElement(h.a,{text:"Ошибка настроек компоновки..."});const c=e.height||e.minHeight||500,d=!o||c>572;return[!e.ignoreTitle&&s.a.createElement(G.a,{key:"helmet",title:e.title},s.a.createElement("meta",{name:"description",content:"Отчет"}),s.a.createElement("meta",{property:"og:title",content:e.title}),s.a.createElement("meta",{property:"og:description",content:"Отчет"})),!e.hideToolbar&&s.a.createElement(k,{key:"toolbar",_obj:a,_tabular:l,_columns:n,scheme:r,settings_open:o,ToolbarExt:e.ToolbarExt,handleSettingsOpen:this.handleSettingsOpen,handleSettingsClose:this.handleSettingsClose,handleSchemeChange:this.handleSchemeChange,handleSave:this.handleSave,handlePrint:this.handlePrint,handleClose:this.handleClose}),o&&s.a.createElement(N.a,{key:"tabs",height:d?272:c-104,width:e.width,scheme:r,tabParams:i&&s.a.createElement(i,{_obj:a,scheme:r}),handleSchemeChange:this.handleSchemeChange}),d&&s.a.createElement(H,{key:"tabular",ref:e=>this._result=e,_obj:a,_tabular:l,_columns:n,scheme:r,minHeight:c-52-(o?320:0),hideHeader:e.hideHeader})]}}I.propTypes={_mgr:r.a.object.isRequired,_obj:r.a.object,_meta:r.a.object,_tabular:r.a.string,_acl:r.a.string,read_only:r.a.bool,autoexec:r.a.bool,ignoreTitle:r.a.bool,handlePrint:r.a.func,handleSchemeChange:r.a.func,handleColumns:r.a.func,registerRep:r.a.func,ToolbarExt:r.a.func};var A=Object(J.withIface)(I);t.default=A}}]);
//# sourceMappingURL=44.3a4fd472.chunk.js.map