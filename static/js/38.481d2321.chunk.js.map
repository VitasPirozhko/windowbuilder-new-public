{"version":3,"sources":["components/CalcOrder/ClientOfDealerSearch/styles.js","components/CalcOrder/ClientOfDealerSearch/connect.js","components/CalcOrder/ClientOfDealerSearch/List.js","components/CalcOrder/ClientOfDealerSearch/ClientOfDealerSearch.js","components/CalcOrder/ClientOfDealerSearch/index.js"],"names":["withStyles","theme","search","minWidth","left","paddingLeft","bar","secondary","marginTop","spacing","groupTitle","fontWeight","listitem","paddingTop","paddingBottom","compose","connect","state","props","searchOrders","length","Promise","resolve","$p","adapters","pouch","local","doc","query","startkey","endkey","limit","reduce","then","rows","res","value","id","row","indexOf","push","name","orders","sort","a","b","handleCalck","key","split","include_docs","parseInt","dialog","_mgr","ref","this","by_ref","client_of_dealer","phone","handleCancel","handlers","handleIfaceState","component","ClientList","classes","onClick","MenuList","map","MenuItem","className","ListItemText","primary","join","ClientOfDealerSearch","Component","constructor","context","super","doSearch","toLowerCase","setState","catch","err","msg","show_msg","type","text","message","title","main_title","handleChange","event","target","clearTimeout","_timer","setTimeout","bind","render","Dialog","open","initFullScreen","large","Input","onChange","placeholder","endAdornment","InputAdornment","position","IconButton","onClose","actions","Button","color"],"mappings":"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","file":"static/js/38.481d2321.chunk.js","sourcesContent":["/**\r\n * ### Карточка покупателя\r\n * стили оформления\r\n *\r\n * Created by Evgeniy Malyarov on 14.03.2018.\r\n */\r\n\r\nimport {withStyles} from '@material-ui/styles';\r\n\r\nconst styles = theme => ({\r\n  search: {\r\n    minWidth: 280,\r\n  },\r\n  left: {\r\n    paddingLeft: 0,\r\n  },\r\n  bar: {\r\n\r\n  },\r\n  secondary: {\r\n    marginTop: -theme.spacing(1.5),\r\n  },\r\n  groupTitle: {\r\n    fontWeight: 'bold',\r\n  },\r\n  listitem: {\r\n    paddingTop: theme.spacing(),\r\n    paddingBottom: theme.spacing(),\r\n  }\r\n});\r\n\r\nexport default withStyles(styles);\r\n","/**\r\n * ### Карточка покупателя\r\n * обработчики событий и модификаторы данных\r\n *\r\n * Created by Evgeniy Malyarov on 13.11.2017.\r\n */\r\n\r\nimport {connect} from 'react-redux';\r\nimport withStyles from './styles';\r\nimport {compose} from 'redux';\r\n\r\n\r\nfunction mapStateToProps(state, props) {\r\n  return {\r\n    searchOrders(search) {\r\n      if(search.length < 2) {\r\n        return Promise.resolve([]);\r\n      }\r\n      return $p.adapters.pouch.local.doc.query('client_of_dealer', {\r\n        startkey: search,\r\n        endkey: search + '\\u0fff',\r\n        limit: 200,\r\n        reduce: false,\r\n      })\r\n        .then(({rows}) => {\r\n          // сворачиваем\r\n          const res = {};\r\n          for (const {value} of rows) {\r\n            const id = `${value[2]} ${value[1]}`;\r\n            if(!res[value[0]]) {\r\n              res[value[0]] = [id];\r\n            }\r\n            else {\r\n              const row = res[value[0]];\r\n              row.indexOf(id) === -1 && row.push(id);\r\n            }\r\n          }\r\n          rows.length = 0;\r\n          for (const name in res) {\r\n            rows.push({name, orders: res[name]});\r\n          }\r\n          rows.sort((a, b) => {\r\n            if(a.name < b.name) {\r\n              return -1;\r\n            }\r\n            else if(a.name > b.name) {\r\n              return 1;\r\n            }\r\n            else {\r\n              return 0;\r\n            }\r\n          });\r\n          return rows;\r\n        });\r\n    },\r\n    handleCalck(row) {\r\n      const key = row.orders[0].split(' ');\r\n      $p.adapters.pouch.local.doc.query('doc/number_doc',\r\n        {\r\n          limit: 1,\r\n          include_docs: true,\r\n          key: ['doc.calc_order', parseInt(key[1].split('-')[0], 10), key[0]],\r\n        })\r\n        .then(({rows}) => {\r\n          const {dialog: {_mgr, ref}} = this.props;\r\n          if(rows.length && _mgr.by_ref[ref]) {\r\n            _mgr.by_ref[ref].client_of_dealer = rows[0].doc.client_of_dealer;\r\n            if(!_mgr.by_ref[ref].phone) {\r\n              _mgr.by_ref[ref].phone = rows[0].doc.phone;\r\n            }\r\n            this.handleCancel();\r\n          }\r\n        });\r\n      //dp.calc_order.production.sync_grid(props.dialog.wnd.elmnts.grids.production);\r\n    },\r\n    handleCancel() {\r\n      props.handlers.handleIfaceState({\r\n        component: 'DataObjPage',\r\n        name: 'dialog',\r\n        value: null,\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\n// function mapDispatchToProps(dispatch) {\r\n//   return {};\r\n// }\r\n\r\nexport default compose(\r\n  withStyles,\r\n  connect(mapStateToProps /*, mapDispatchToProps */),\r\n);\r\n","/**\r\n * Список клиентов\r\n *\r\n * @module List\r\n *\r\n * Created by Evgeniy Malyarov on 21.08.2018.\r\n */\r\n\r\nimport React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport MenuList from '@material-ui/core/MenuList';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\n\r\nexport default function ClientList ({rows, classes, onClick}) {\r\n  return <MenuList>\r\n    {\r\n      rows.length ?\r\n        rows.map((row, key) =>\r\n          <MenuItem key={key} className={classes.left} onClick={() => onClick(row)}>\r\n            <ListItemText\r\n              primary={row.name}\r\n              secondary={row.orders.join(', ')}\r\n            />\r\n          </MenuItem>)\r\n        :\r\n        <MenuItem>Записи не найдены</MenuItem>\r\n    }\r\n  </MenuList>;\r\n}\r\n\r\nClientList.propTypes = {\r\n  classes: PropTypes.object.isRequired,\r\n  rows: PropTypes.array.isRequired,\r\n  onClick: PropTypes.func.isRequired,\r\n};\r\n","/**\r\n * ### Карточка покупателя\r\n * каркас компонента - визуальная глупая часть\r\n *\r\n * Created by Evgeniy Malyarov on 13.11.2017.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from 'metadata-react/App/Dialog';\r\nimport Input from '@material-ui/core/Input';\r\nimport InputAdornment from '@material-ui/core/InputAdornment';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport IconSearch from '@material-ui/icons/Search';\r\nimport connect from './connect';\r\nimport List from './List';\r\n\r\nclass ClientOfDealerSearch extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.handleCancel = props.handleCancel.bind(this);\r\n    this.handleCalck = props.handleCalck.bind(this);\r\n    this.state = {search: '', rows: []};\r\n    this._timer = 0;\r\n  }\r\n\r\n  doSearch = () => {\r\n    this.props.searchOrders(this.state.search.toLowerCase())\r\n      .then((rows) => this.setState({rows}))\r\n      .catch((err) => {\r\n        $p.msg.show_msg({\r\n          type: \"alert-warning\",\r\n          text: `${err.name}<br/>${err.message}`,\r\n          title: $p.msg.main_title\r\n        });\r\n      });\r\n  }\r\n\r\n  handleChange = (event) => {\r\n    this.setState({search: event.target.value});\r\n    clearTimeout(this._timer);\r\n    this._timer = setTimeout(this.doSearch, 750);\r\n  };\r\n\r\n  render() {\r\n\r\n    const {handleCancel, handleCalck, props, state} = this;\r\n    const {classes} = props;\r\n\r\n    return <Dialog\r\n      open\r\n      initFullScreen\r\n      large\r\n      title={<Input\r\n        value={this.state.search}\r\n        onChange={this.handleChange}\r\n        placeholder=\"Введите текст для поиска\"\r\n        className={classes.search}\r\n        endAdornment={\r\n          <InputAdornment position=\"end\">\r\n            <IconButton>\r\n              <IconSearch />\r\n            </IconButton>\r\n          </InputAdornment>\r\n        }\r\n      />}\r\n      onClose={handleCancel}\r\n      actions={[\r\n        <Button key=\"cancel\" onClick={handleCancel} color=\"primary\">Закрыть</Button>\r\n      ]}\r\n    >\r\n      <List classes={classes} rows={state.rows} onClick={handleCalck}/>\r\n    </Dialog>;\r\n\r\n  }\r\n}\r\n\r\nClientOfDealerSearch.propTypes = {\r\n  classes: PropTypes.object.isRequired,\r\n  dialog: PropTypes.object.isRequired,\r\n  handlers: PropTypes.object.isRequired,\r\n  handleCalck: PropTypes.func.isRequired,\r\n  handleCancel: PropTypes.func.isRequired,\r\n  searchOrders: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connect(ClientOfDealerSearch);\r\n","import ClientOfDealerSearch from './ClientOfDealerSearch';\r\n\r\nexport default ClientOfDealerSearch;\r\n"],"sourceRoot":""}