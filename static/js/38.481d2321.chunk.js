(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[38],{1037:function(e,a,t){"use strict";t.r(a);var n=t(0),s=t.n(n),r=t(159),l=t(85),c=t(115),o=t(458),i=t(160),h=t(735),d=t.n(h),m=t(166),p=t(74);var u=Object(p.a)(e=>({search:{minWidth:280},left:{paddingLeft:0},bar:{},secondary:{marginTop:-e.spacing(1.5)},groupTitle:{fontWeight:"bold"},listitem:{paddingTop:e.spacing(),paddingBottom:e.spacing()}})),g=t(34);var f=Object(g.compose)(u,Object(m.connect)((function(e,a){return{searchOrders:e=>e.length<2?Promise.resolve([]):$p.adapters.pouch.local.doc.query("client_of_dealer",{startkey:e,endkey:e+"࿿",limit:200,reduce:!1}).then(({rows:e})=>{const a={};for(const{value:t}of e){const e=`${t[2]} ${t[1]}`;if(a[t[0]]){const n=a[t[0]];-1===n.indexOf(e)&&n.push(e)}else a[t[0]]=[e]}e.length=0;for(const t in a)e.push({name:t,orders:a[t]});return e.sort((e,a)=>e.name<a.name?-1:e.name>a.name?1:0),e}),handleCalck(e){const a=e.orders[0].split(" ");$p.adapters.pouch.local.doc.query("doc/number_doc",{limit:1,include_docs:!0,key:["doc.calc_order",parseInt(a[1].split("-")[0],10),a[0]]}).then(({rows:e})=>{const{dialog:{_mgr:a,ref:t}}=this.props;e.length&&a.by_ref[t]&&(a.by_ref[t].client_of_dealer=e[0].doc.client_of_dealer,a.by_ref[t].phone||(a.by_ref[t].phone=e[0].doc.phone),this.handleCancel())})},handleCancel(){a.handlers.handleIfaceState({component:"DataObjPage",name:"dialog",value:null})}}}))),C=t(455),_=t(206),b=t(521);function w({rows:e,classes:a,onClick:t}){return s.a.createElement(C.a,null,e.length?e.map((e,n)=>s.a.createElement(_.a,{key:n,className:a.left,onClick:()=>t(e)},s.a.createElement(b.a,{primary:e.name,secondary:e.orders.join(", ")}))):s.a.createElement(_.a,null,"Записи не найдены"))}class y extends n.Component{constructor(e,a){super(e,a),this.doSearch=()=>{this.props.searchOrders(this.state.search.toLowerCase()).then(e=>this.setState({rows:e})).catch(e=>{$p.msg.show_msg({type:"alert-warning",text:`${e.name}<br/>${e.message}`,title:$p.msg.main_title})})},this.handleChange=e=>{this.setState({search:e.target.value}),clearTimeout(this._timer),this._timer=setTimeout(this.doSearch,750)},this.handleCancel=e.handleCancel.bind(this),this.handleCalck=e.handleCalck.bind(this),this.state={search:"",rows:[]},this._timer=0}render(){const{handleCancel:e,handleCalck:a,props:t,state:n}=this,{classes:h}=t;return s.a.createElement(l.a,{open:!0,initFullScreen:!0,large:!0,title:s.a.createElement(c.a,{value:this.state.search,onChange:this.handleChange,placeholder:"Введите текст для поиска",className:h.search,endAdornment:s.a.createElement(o.a,{position:"end"},s.a.createElement(i.a,null,s.a.createElement(d.a,null)))}),onClose:e,actions:[s.a.createElement(r.a,{key:"cancel",onClick:e,color:"primary"},"Закрыть")]},s.a.createElement(w,{classes:h,rows:n.rows,onClick:a}))}}var k=f(y);a.default=k}}]);
//# sourceMappingURL=38.481d2321.chunk.js.map