(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[17],{1039:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(563),o=n(456),c=n(460),i=n(521),l=n(531),d=n(160),p=n(214),u=n.n(p),h=n(562),m=n.n(h),_=n(522),f=n(532),g=n(555),y=n(548);class C extends s.a.Component{constructor(e){super(e),this.onRowUpdated=(e,t)=>{if(e&&Object.prototype.hasOwnProperty.call(e,"inset")){const{inset:e}=t;$p.cat.clrs.selection_exclude_service(this.props.meta.fields.clr,e),e.clr_group.default_clr(t)}},this.onCellSelected=e=>{const{props:{meta:t},tabular:n}=this;if(n&&n.state._columns){const a=n.state._columns[e.idx],{key:s}=a,r=t.fields[s]||{choice_params:[],type:{is_ref:!0,types:["cat.property_values"],_mgr:$p.cat.property_values}};this.selectedRow=n.rowGetter(e.rowIdx),"clr"===s?$p.cat.clrs.selection_exclude_service(r,this.selectedRow.inset):$p.utils.is_guid(s)&&this.selectedRow.tune(s,r,a)}},this.selectedRow=null,this.handleAdd=y.e.bind(this),this.handleRemove=y.f.bind(this),this.state={count:e.count}}render(){const{props:e,state:{count:t},handleAdd:n,handleRemove:a}=this,{Renderer:r,group:o,dp:p,classes:h,scheme:g,meta:y}=e,{ref:C,presentation:k}=o,b={flex:"initial"};return t&&(b.minHeight=80+33*(t-1)),s.a.createElement("div",{style:b},s.a.createElement(c.a,{disableGutters:!0,className:h.listitem},s.a.createElement(d.a,{title:"Добавить строку",onClick:n},s.a.createElement(u.a,null)),s.a.createElement(d.a,{title:"Удалить строку",disabled:!t,onClick:a},s.a.createElement(m.a,null)),s.a.createElement(i.a,{classes:t?{primary:h.groupTitle}:{},primary:k}),s.a.createElement(l.a,{className:h.secondary},t?g.filter(p.production).reduce((e,t)=>e+t.quantity,0)+" шт":"")),s.a.createElement(f.a,{in:!!t,timeout:100,classes:{entered:h.entered}},s.a.createElement("div",{style:{height:(b.minHeight||0)+35}},s.a.createElement(r,{tref:e=>this.tabular=e,minHeight:b.minHeight,dp:p,group:o,scheme:g,meta:y,onRowUpdated:this.onRowUpdated,onCellSelected:this.onCellSelected,onCellDeSelected:()=>this.selectedRow=null}))),!t&&s.a.createElement(_.a,{key:"d"+C}))}}var k=Object(g.a)(C);class b extends s.a.Component{constructor(e,t){super(e,t),this.inset_change=(e,t)=>{const{groups:n,dp:a}=this;if(t&&t.inset&&e._owner==a.production){const t=n.get(e.inset.insert_type);t&&t.forceUpdate()}},this.state={schemas:null},this.groups=new Map}componentDidMount(){y.b.call(this,this.props.dialog.ref);const{cat:e,dp:t}=$p;y.c.call(this,e.scheme_settings.find_rows({obj:"dp.buyers_order.production",user:""})),t.buyers_order.on("update",this.inset_change)}componentWillUnmount(){$p.dp.buyers_order.off("update",this.inset_change)}render(){const{items:e,components:t,dp:n}=this,{schemas:a}=this.state||{};return s.a.createElement(o.a,null,a?e.map(e=>{if(!e||!y.d.call({},e))return null;const r=t.get(e);return s.a.createElement(k,Object.assign({key:""+e.ref,ref:t=>this.groups.set(e,t),dp:n,group:e},r,{scheme:a.get(e)}))}):s.a.createElement(c.a,null,s.a.createElement(i.a,{primary:"Чтение настроек компоновки..."})))}}t.default=function(e){return s.a.createElement(r.a,Object.assign({Content:b,title:"Аксессуары и услуги"},e))}},548:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return h})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return _}));var a=n(166),s=n(555),r=n(34),o=n(0),c=n.n(o),i=n(546);class l extends o.Component{render(){const{dp:e,meta:t,scheme:n,tref:a,onRowUpdated:s,onCellSelected:r,minHeight:o}=this.props;return c.a.createElement(i.a,{ref:a,_obj:e,_meta:t,_tabular:"production",scheme:n,onRowUpdated:s,onCellSelected:r,minHeight:o,hideToolbar:!0})}}const{ItemData:d}=$p.cat.inserts;function p(e,t){t||(t=this.items=$p.enm.inserts_types.additions_groups);const n=this.dp=$p.dp.buyers_order.create();n.calc_order=$p.doc.calc_order.by_ref[e];const a=this.components=new Map;t.forEach(e=>a.set(e,new d(e,l)));const{production:s,product_params:r}=n;n._data._loading=!0,n.calc_order.production.find_rows({ordn:$p.utils.blank.guid},e=>{const{characteristic:n}=e,{origin:o}=n;if(!n.empty()&&o&&!o.empty()&&-1!=t.indexOf(o.insert_type)){const t=a.get(o.insert_type),c=s.count()+1;n.params.forEach(({param:e,value:t})=>{r.add({elm:c,param:e,value:t})}),s.add({characteristic:n,inset:o,clr:n.clr,len:e.len,height:e.width,quantity:e.quantity,note:e.note},!1,t.ProductionRow),t.count++}}),n._data._loading=!1}function u(e=[]){const t=new Map;for(const n of e)for(const e of this.items)if(e&&n.name==e.name){t.set(e,n);break}this.setState({schemas:t})}function h(){const{tabular:e,props:t}=this,n=_.call(this,t.group);if(n&&e){const{_data:a}=e.state._tabular._owner;a._loading=!0;const s=e.state._tabular.add({inset:n,quantity:1},!1,t.ProductionRow);if(a._loading=!1,s.value_change("inset","force",s.inset),this.setState({count:this.state.count+1}),n.insert_type==$p.enm.inserts_types.Параметрик)for(let t=0;t<s.row;t++)if(e.rowGetter(t)===s){setTimeout(()=>e._grid.selectCell({rowIdx:t,idx:0},!0));break}}else $p.msg.show_msg({type:"alert-info",text:`Нет вставки подходящего типа (${t.group})`,title:"Новая строка"})}function m(){const{props:e,tabular:t,state:n,selectedRow:a}=this;if(t&&a){const{calc_order_row:s}=a.characteristic;a._owner.del(a),this.selectedRow=null,t.forceUpdate(),n.count&&this.setState({count:n.count-1}),s&&s._owner.del(s),e.onSelect&&e.onSelect(null)}else $p.msg.show_msg({type:"alert-info",text:`Укажите строку для удаления (${e.group})`,title:"Удаление строки"})}function _(e){if(!this._inset){const{choice_params:t}=$p.dp.buyers_order.metadata("production").fields.inset,n={insert_type:e};t&&t.forEach(({name:e,path:t})=>{"insert_type"!==e&&(Object.prototype.hasOwnProperty.call(n,e)?(n[e]=[n[e]],n[e].push(t)):n[e]=t)}),this._inset=$p.cat.inserts.find_rows(n).reduce((e,t)=>e&&e.priority>=t.priority?e:t,null)}return this._inset}t.a=Object(r.compose)(s.a,Object(a.connect)((function(e,t){return{handleCalck(){const{additions:e}=this,{dp:n}=e;return n?n.calc_order.process_add_product_list(n).then(()=>{n.calc_order.production.sync_grid(t.dialog.wnd.elmnts.grids.production)}):e.handleCalck()},handleCancel(){t.handlers.handleIfaceState({component:"DataObjPage",name:"dialog",value:null})}}})))},555:function(e,t,n){"use strict";var a=n(74);t.a=Object(a.a)(e=>({entered:{minHeight:120},secondary:{marginTop:-e.spacing(1.5)},groupTitle:{fontWeight:"bold"},listitem:{paddingTop:e.spacing(),paddingBottom:e.spacing()}}))},562:function(e,t,n){"use strict";var a=n(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(n(0)),r=(0,a(n(13)).default)(s.default.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");t.default=r},563:function(e,t,n){"use strict";var a=n(0),s=n.n(a),r=n(159),o=n(85),c=n(548);class i extends s.a.Component{constructor(e,t){super(e,t),this.handleOk=()=>{this.props.handleCalck.call(this).then(this.handleCancel).catch(e=>{this.setState({msg:e.msg||e.message})})},this.handleCalck=()=>{this.props.handleCalck.call(this).catch(e=>{this.setState({msg:e.msg})})},this.handleErrClose=()=>{this.setState({msg:null,queryClose:!1})},this.queryClose=()=>{this.setState({queryClose:!0})};const{handleCancel:n}=e;this.handleCancel=n.bind(this),this.state={msg:null,queryClose:!1}}render(){const{handleCancel:e,handleErrClose:t,props:{dialog:n,title:a,actions:c,Content:i},state:{msg:l,queryClose:d}}=this;return s.a.createElement(o.a,{open:!0,initFullScreen:!0,large:!0,title:a,onClose:this.queryClose,actions:[!c&&s.a.createElement(r.a,{key:"ok",onClick:this.handleOk,color:"primary"},"Рассчитать и закрыть"),c&&c.ok&&s.a.createElement(r.a,{key:"ok",onClick:this.handleOk,color:"primary"},c.ok),!c&&s.a.createElement(r.a,{key:"calck",onClick:this.handleCalck,color:"primary"},"Рассчитать"),c&&c.calck&&s.a.createElement(r.a,{key:"calck",onClick:this.handleCalck,color:"primary"},c.calck),s.a.createElement(r.a,{key:"cancel",onClick:e,color:"primary"},"Закрыть")]},s.a.createElement(i,{ref:e=>this.additions=e,dialog:n}),l&&s.a.createElement(o.a,{open:!0,title:l.title||"Ошибка при записи",onClose:t,actions:[s.a.createElement(r.a,{key:"ok",onClick:t,color:"primary"},"Ок")]},l.obj&&s.a.createElement("div",null,l.obj.name),l.text||l),d&&s.a.createElement(o.a,{open:!0,title:`Закрыть ${a.toLowerCase()}?`,onClose:t,actions:[s.a.createElement(r.a,{key:"ok",onClick:e,color:"primary"},"Ок"),s.a.createElement(r.a,{key:"cancel",onClick:t,color:"primary"},"Отмена")]},"Внесённые изменения будут потеряны"))}}t.a=Object(c.a)(i)}}]);
//# sourceMappingURL=17.9296fd42.chunk.js.map