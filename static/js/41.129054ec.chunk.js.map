{"version":3,"sources":["components/PushUtils/styles.js","components/PushUtils/connect.js","components/PushUtils/Progress.js","components/PushUtils/Download.js","components/PushUtils/Inbox.js","components/PushUtils/Share.js","components/PushUtils/UtilsRouter.js","components/PushUtils/index.js"],"names":["withStyles","theme","entered","minHeight","secondary","marginTop","spacing","groupTitle","fontWeight","listitem","paddingTop","paddingBottom","compose","connect","state","props","handleCalck","Promise","resolve","handleCancel","handlers","handleIfaceState","component","name","value","dialog","cmd","handleOpen","ref","handleNavigate","replace","Progress","AbstractProgress","on_index","info","this","setState","step","index","sync_orders","docs","keys","local","remote","$p","adapters","pouch","completed","buffer","doc","allDocs","then","rows","diff","rdoc","some","key","id","rev","_id","_rev","push","ldoc","length","include_docs","attachments","bulkDocs","filter","v","map","new_edits","sync_products","production","row","characteristic","utils","blank","guid","all","res","error","difs","dif","reduce","sum","_attachments","rebuild_indexes","dbid","on","off","timer","clearInterval","setTimeout","wnd","elmnts","call_event","propTypes","PropTypes","func","isRequired","Download","init","moment","calc_order","create","prefix","number_doc","substr","unload","query","limit","startkey","class_name","Date","getFullYear","endkey","descending","find","selector","date","$gte","subtract","format","$lte","add","fields","indexOf","catch","err","message","object","Inbox","get","current_user","sort","a","b","ta","timestamp","tb","render","List","posted","partner","client_of_dealer","manager","ListItem","button","onDoubleClick","ListItemText","primary","_masks","ldt","cat","partners","users","user","style","flexGrow","LinearProgress","color","variant","valueBuffer","Share","Component","constructor","context","super","handleToggle","Object","prototype","hasOwnProperty","call","status","put","forceUpdate","is_empty_guid","branch","empty","componentDidMount","Map","is_new","load","find_rows","push_only","o","set","size","Array","from","assign","Typography","gutterBottom","presentation","onClick","Checkbox","checked","tabIndex","disableRipple","UtilsRouter","handleOk","bind","title","renderContent","Dialog","open","initFullScreen","large","onClose","actions","Button"],"mappings":"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","file":"static/js/41.129054ec.chunk.js","sourcesContent":["/**\r\n * ### Карточка покупателя\r\n * стили оформления\r\n *\r\n * Created by Evgeniy Malyarov on 14.03.2018.\r\n */\r\n\r\nimport {withStyles} from '@material-ui/styles';\r\n\r\nconst styles = theme => ({\r\n  entered: {\r\n    minHeight: 120,\r\n  },\r\n  secondary: {\r\n    marginTop: -theme.spacing(1.5),\r\n  },\r\n  groupTitle: {\r\n    fontWeight: 'bold',\r\n  },\r\n  listitem: {\r\n    paddingTop: theme.spacing(),\r\n    paddingBottom: theme.spacing(),\r\n  }\r\n});\r\n\r\nexport default withStyles(styles);\r\n","/**\r\n * ### Карточка покупателя\r\n * обработчики событий и модификаторы данных\r\n *\r\n * Created by Evgeniy Malyarov on 13.11.2017.\r\n */\r\n\r\nimport {connect} from 'react-redux';\r\nimport withStyles from './styles';\r\nimport {compose} from 'redux';\r\n\r\n\r\nfunction mapStateToProps(state, props) {\r\n  return {\r\n    handleCalck() {\r\n      //dp.calc_order.production.sync_grid(props.dialog.wnd.elmnts.grids.production);\r\n      return Promise.resolve();\r\n    },\r\n    handleCancel() {\r\n      props.handlers.handleIfaceState({\r\n        component: 'CalcOrderList',\r\n        name: 'dialog',\r\n        value: null,\r\n      });\r\n      if(props.dialog.cmd === 'btn_share') {\r\n        props.handlers.handleIfaceState({\r\n          component: 'DataObjPage',\r\n          name: 'dialog',\r\n          value: null,\r\n        });\r\n      }\r\n    },\r\n    handleOpen(ref) {\r\n      props.handlers.handleNavigate(`/doc.calc_order/${ref.replace('doc.calc_order|', '')}`);\r\n    }\r\n  };\r\n}\r\n\r\n// function mapDispatchToProps(dispatch) {\r\n//   return {};\r\n// }\r\n\r\nexport default compose(\r\n  withStyles,\r\n  connect(mapStateToProps /*, mapDispatchToProps */),\r\n);\r\n","/**\r\n * Абстрактный компонент с индикатором прогресса\r\n *\r\n * @module Progress\r\n *\r\n * Created by Evgeniy Malyarov on 24.03.2018.\r\n */\r\n\r\nimport PropTypes from 'prop-types';\r\nimport AbstractProgress from './AbstractProgress';\r\n\r\nclass Progress extends AbstractProgress {\r\n\r\n  /**\r\n   * Синхронизирует массив заказов\r\n   * @param refs\r\n   */\r\n  sync_orders(docs, keys) {\r\n\r\n    const {local, remote} = $p.adapters.pouch;\r\n\r\n    this.setState({step: 'Сравниваем версии заказов local и remote...', completed: 0, buffer: 10});\r\n\r\n    return remote.doc.allDocs({keys})\r\n      .then(({rows}) => {\r\n        const diff = [];\r\n        for(const rdoc of rows) {\r\n          if(rdoc.value){\r\n            if(!docs.some((doc) => {\r\n                return doc.key && doc.value ?\r\n                  doc.id === rdoc.id && doc.value.rev === rdoc.value.rev : doc._id === rdoc.id && doc._rev === rdoc.value.rev;\r\n              })) {\r\n              diff.push(rdoc.id);\r\n            }\r\n          }\r\n          else {\r\n            // TODO: обработать пометку удаления\r\n          }\r\n        }\r\n        return {ldoc: keys, diff};\r\n      })\r\n      .then(({ldoc, diff}) => {\r\n        if(diff.length) {\r\n          this.setState({step: 'Получаем объекты заказов с сервера...', completed: 0, buffer: 10});\r\n          return remote.doc.allDocs({include_docs: true, attachments: true, keys: diff})\r\n            .then(({rows}) => {\r\n              this.setState({step: 'Записываем изменённые заказы...'});\r\n              return local.doc.bulkDocs(rows.filter((v) => v.doc).map(({doc}) => doc), {new_edits: false});\r\n            })\r\n            .then(() => {\r\n              this.setState({step: 'Получаем объекты заказов из базы браузера...', completed: 0, buffer: 10});\r\n              return local.doc.allDocs({include_docs: true, keys: ldoc});\r\n            });\r\n        }\r\n        else {\r\n          this.setState({step: 'Получаем объекты заказов из базы браузера...', completed: 0, buffer: 10});\r\n          return local.doc.allDocs({include_docs: true, keys: ldoc});\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Синхронизирует продукции\r\n   * @param refs\r\n   */\r\n  sync_products(docs) {\r\n\r\n    const {local, remote} = $p.adapters.pouch;\r\n\r\n    const keys = [];\r\n    for (const {production} of docs) {\r\n      if(production) {\r\n        for (const row of production) {\r\n          if(row.characteristic && row.characteristic !== $p.utils.blank.guid) {\r\n            keys.push(`cat.characteristics|${row.characteristic}`);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.setState({step: 'Сравниваем версии характеристик продукций...', completed: 0, buffer: 10});\r\n\r\n    return Promise.all([\r\n      local.doc.allDocs({keys}),\r\n      remote.doc.allDocs({keys}),\r\n    ])\r\n      .then((res) => {\r\n        const ldoc = res[0].rows;\r\n        const diff = [];\r\n        for(const rdoc of res[1].rows) {\r\n          if(!rdoc.value) {\r\n            // TODO: обработать удаление\r\n            continue;\r\n          }\r\n          if(!ldoc.some((doc) => {\r\n              return !doc.error && doc.id === rdoc.id && doc.value.rev === rdoc.value.rev;\r\n            })) {\r\n            diff.push(rdoc.id);\r\n          }\r\n        }\r\n        // формируем массив пачек по 100 элементов\r\n        const difs = {\r\n          length: diff.length,\r\n          rows: []\r\n        };\r\n        this.setState({step: `Найдено ${difs.length} отличий в характеристиках`, completed: 0, buffer: 10});\r\n        let rows = [];\r\n        for(const dif of diff) {\r\n          if(rows.length < 100) {\r\n            rows.push(dif);\r\n          }\r\n          else {\r\n            difs.rows.push(rows);\r\n            rows = [dif];\r\n          }\r\n        }\r\n        if(rows.length) {\r\n          difs.rows.push(rows);\r\n        }\r\n        return difs;\r\n      })\r\n      .then((difs) => {\r\n        // редуцируем\r\n        return difs.rows.reduce((sum, keys, index) => {\r\n          return sum.then(() => {\r\n            this.setState({step: `Обработано ${index * 100} из ${difs.length} характеристик продукций`});\r\n            return remote.doc.allDocs({include_docs: true, keys})\r\n              .then(({rows}) => {\r\n                // const deleted = rows.filter((v) => !v.doc);\r\n                return local.doc.bulkDocs(rows.filter((v) => v.doc && !v.doc._attachments).map((v) => v.doc), {new_edits: false});\r\n              });\r\n          });\r\n        }, Promise.resolve());\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Перестраивает индексы\r\n   */\r\n  rebuild_indexes(dbid = 'doc') {\r\n\r\n    this.setState({step: `Перестраиваем индексы...`, completed: 0, buffer: 10});\r\n    $p.adapters.pouch.on('rebuild_indexes', this.on_index);\r\n\r\n    return $p.adapters.pouch.rebuild_indexes(dbid, true)\r\n      .then(() => {\r\n        $p.adapters.pouch.off('rebuild_indexes', this.on_index);\r\n        if(this.timer) {\r\n          clearInterval(this.timer);\r\n          this.timer = 0;\r\n        }\r\n        this.setState({error: 'Обработка завершена'});\r\n        setTimeout(() => {\r\n          const {props} = this;\r\n          props.handleCancel();\r\n          if(props.dialog && props.dialog.wnd) {\r\n            const {elmnts} = props.dialog.wnd;\r\n            elmnts && elmnts.filter && elmnts.filter.call_event();\r\n          }\r\n        }, 2000);\r\n      });\r\n\r\n  }\r\n\r\n  on_index = (info) => {\r\n    this.setState({step: `Перестраиваем индекс ${info.index}...`});\r\n  }\r\n\r\n}\r\n\r\nProgress.propTypes = {\r\n  handleCancel: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Progress;\r\n","/**\r\n * Обновляет заказы и продукции из облака\r\n *\r\n * @module Download\r\n *\r\n * Created by Evgeniy Malyarov on 24.03.2018.\r\n */\r\n\r\nimport PropTypes from 'prop-types';\r\nimport Progress from './Progress';\r\n\r\nclass Download extends Progress {\r\n\r\n  init() {\r\n\r\n    const {local, remote} = $p.adapters.pouch;\r\n    const {utils: {moment}, doc: {calc_order}} = $p;\r\n\r\n    this.setState({step: 'Получаем последние 70 заказов текущего пользователя...'});\r\n    // создадим fake-заказ, чтобы безопасно рассчитать префикс\r\n    calc_order.create({}, true)\r\n      .then((doc) => {\r\n        const prefix = doc.number_doc.substr(0, 7);\r\n        // выгружаем fake-заказ из памяти, он нам больше не нужен\r\n        doc.unload();\r\n        return remote.doc.query('doc/number_doc',\r\n          {\r\n            limit: 70,\r\n            include_docs: false,\r\n            startkey: [calc_order.class_name, new Date().getFullYear(), prefix + '\\ufff0'],\r\n            endkey: [calc_order.class_name, new Date().getFullYear(), prefix],\r\n            descending: true,\r\n          });\r\n      })\r\n      .then(({rows}) => {\r\n        this.setState({step: 'Получаем массив заказов текущей базы...'});\r\n        return local.doc.find({\r\n          selector: {\r\n            class_name: calc_order.class_name,\r\n            date: {\r\n              $gte: moment().subtract(3, 'months').format('YYYY-MM-DD'),\r\n              $lte: moment().add(1, 'months').format('YYYY-MM-DD')\r\n            }\r\n          },\r\n          fields: ['_id', '_rev', 'state'],\r\n          limit: 10000,\r\n        })\r\n          .then(({docs}) => {\r\n            const keys = docs.filter((v) => v.state !== 'template').map((v) => v._id);\r\n            for(const {id} of rows) {\r\n              keys.indexOf(id) === -1 && keys.push(id);\r\n            }\r\n            return this.sync_orders(docs, keys);\r\n          });\r\n      })\r\n      .then(({rows}) => {\r\n        const docs = rows.filter((v) => v.doc).map((v) => v.doc);\r\n        return this.sync_products(docs);\r\n      })\r\n      .then(() => {\r\n        return this.rebuild_indexes();\r\n      })\r\n      .catch((err) => {\r\n        this.setState({error: err.message || 'Ошибка синхронизации заказов'});\r\n      });\r\n  }\r\n}\r\n\r\nDownload.propTypes = {\r\n  dialog: PropTypes.object.isRequired,\r\n  handleCancel: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Download;\r\n","/**\r\n * Заказы, отправленные сотруднику с push автономным режимом работы\r\n *\r\n * @module Inbox\r\n *\r\n * Created by Evgeniy Malyarov on 24.03.2018.\r\n */\r\n\r\nimport React from 'react';\r\nimport Progress from './Progress';\r\nimport PropTypes from 'prop-types';\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\n\r\nclass Inbox extends Progress {\r\n\r\n  init() {\r\n\r\n    const {local, remote} = $p.adapters.pouch;\r\n\r\n    // получим local-документ текущего пользователя\r\n    this.setState({step: 'Получаем inbox-документ текущего пользователя...'});\r\n    remote.doc.get(`_local/inbox_${$p.current_user.ref}`)\r\n      .then((doc) => {\r\n        this.setState({step: 'Сравниваем версии входящих заказов...'});\r\n        const docs = [];\r\n        for(const ref in doc) {\r\n          if(ref[0] == '_') {\r\n            continue;\r\n          }\r\n          docs.push({ref});\r\n        }\r\n        const keys = docs.map((v) => `doc.calc_order|${v.ref}`);\r\n        return local.doc.allDocs({keys})\r\n          .then(({rows}) => {\r\n            return this.sync_orders(rows, keys);\r\n          });\r\n      })\r\n      .then(({rows}) => {\r\n        const docs = rows.filter((v) => v.doc).map((v) => v.doc);\r\n        return this.sync_products(docs)\r\n          .then(() => {\r\n            docs.sort((a, b) => {\r\n              const ta = a.timestamp ? a.timestamp.moment : a.date;\r\n              const tb = b.timestamp ? b.timestamp.moment : b.date;\r\n              if(ta > tb) {\r\n                return -1;\r\n              }\r\n              if(tb > ta) {\r\n                return 1;\r\n              }\r\n              return 0;\r\n            });\r\n            if(this.timer){\r\n              clearInterval(this.timer);\r\n              this.timer = 0;\r\n            }\r\n            this.setState({docs});\r\n          });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({error: err.message || `Ошибка доступа к _local/inbox_`});\r\n      });\r\n  }\r\n\r\n  handleOpen = value => () => {\r\n    this.props.handleCancel();\r\n    this.props.handleOpen(value);\r\n  }\r\n\r\n  render() {\r\n    const {error, step, docs, completed, buffer} = this.state;\r\n    const {moment} = $p.utils;\r\n\r\n    if(error) {\r\n      return <div>{error}</div>;\r\n    }\r\n\r\n    if(docs) {\r\n      return <List key=\"list\">\r\n        {docs.map(value => {\r\n          const {_id, number_doc, date, posted, timestamp, partner, client_of_dealer, manager} = value;\r\n          return <ListItem\r\n            key={_id}\r\n            button\r\n            onDoubleClick={this.handleOpen(_id)}\r\n          >\r\n            <ListItemText\r\n              primary={`№${number_doc || 'б/н'} от ${moment(date).format(moment._masks.ldt)} (${posted ? '' : 'не '}проведен), ${\r\n              client_of_dealer || $p.cat.partners.get(partner).name || 'Клиент не указан'}`}\r\n              secondary={`${$p.cat.users.get(manager).name || timestamp && timestamp.user}`}\r\n            />\r\n          </ListItem>;\r\n        })}\r\n      </List>;\r\n    }\r\n\r\n    return [\r\n      <div key=\"progress\" style={{flexGrow: 1}}>\r\n        <LinearProgress color=\"secondary\" variant=\"buffer\" value={completed} valueBuffer={buffer} />\r\n        <br />\r\n      </div>,\r\n      <div key=\"text\">{step}</div>\r\n    ];\r\n  }\r\n}\r\n\r\nInbox.propTypes = {\r\n  dialog: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default Inbox;\r\n","/**\r\n * Отправляет ссылку на заказ некому сотруднику\r\n *\r\n * @module Share\r\n *\r\n * Created by Evgeniy Malyarov on 24.03.2018.\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nclass Share extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    this.state = {\r\n      error: '',\r\n      doc: null,\r\n      users: null,\r\n    };\r\n    const {ref} = this.props.dialog;\r\n    const {current_user} = $p;\r\n\r\n    if($p.utils.is_empty_guid(ref)) {\r\n      this.state.error = 'При открытии из формы списка, укажите текущую строку заказа, который собираетесь отправить сотруднику';\r\n    }\r\n    else if(!current_user || current_user.branch.empty()) {\r\n      this.state.error = 'Нельзя поделиться заказом центральной базы - только из базы отдела';\r\n    }\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    const {state: {error}, props: {dialog}} = this;\r\n    const users = new Map();\r\n\r\n    if(!error) {\r\n      const doc = $p.doc.calc_order.get(dialog.ref);\r\n      const {branch} = $p.current_user;\r\n      (doc.is_new() ? doc.load() : Promise.resolve())\r\n        .then(() => {\r\n          $p.cat.users.find_rows({branch, push_only: true}, (o) => users.set(o, {}));\r\n          if(users.size < 1) {\r\n            this.setState({error: `Некому отправлять, в филиале \"${branch.name}\", нет сотрудников с push-репликацией`});\r\n          }\r\n          else {\r\n            // получим local-документы пользователей\r\n            $p.adapters.pouch.remote.doc.allDocs({\r\n              include_docs: true,\r\n              keys: Array.from(users.keys()).map((v) => `_local/inbox_${v.ref}`)\r\n            })\r\n              .then(({rows}) => {\r\n                for (const row of rows) {\r\n                  const map = users.get($p.cat.users.get(row.key.replace('_local/inbox_', '')));\r\n                  if(row.error) {\r\n                    map._id = row.key;\r\n                  }\r\n                  else {\r\n                    Object.assign(map, row.doc);\r\n                  }\r\n                }\r\n                this.setState({doc, users});\r\n              })\r\n              .catch((err) => {\r\n                this.setState({error: err.message || `Ошибка доступа к _local/inbox_`});\r\n              });\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  handleToggle = value => () => {\r\n    const map = this.state.users.get(value);\r\n    const {ref} = this.state.doc;\r\n    const {doc} = $p.adapters.pouch.remote;\r\n    if(Object.prototype.hasOwnProperty.call(map, ref)) {\r\n      delete map[ref];\r\n    }\r\n    else {\r\n      map[ref] = true;\r\n    }\r\n\r\n    // результат сразу записываем\r\n    doc.get(map._id)\r\n      .catch((err) => {\r\n        if(err.status != 404) {\r\n          throw err;\r\n        }\r\n        return map;\r\n      })\r\n      .then((rdoc) => {\r\n        if(rdoc !== map) {\r\n          if(Object.prototype.hasOwnProperty.call(rdoc, ref)) {\r\n            delete rdoc[ref];\r\n          }\r\n          else {\r\n            rdoc[ref] = true;\r\n          }\r\n        }\r\n        return doc.put(rdoc);\r\n      })\r\n      .then(() => {\r\n        this.forceUpdate();\r\n      })\r\n      .catch((err) => {\r\n        this.setState({error: err.message || `Не удалось записать ${map._id}`});\r\n      });\r\n  };\r\n\r\n  render() {\r\n\r\n    const {error, doc, users} = this.state;\r\n\r\n    if(error) {\r\n      return <div>{error}</div>;\r\n    }\r\n\r\n    if(!doc) {\r\n      return <div>Подготовка данных...</div>;\r\n    }\r\n\r\n    return [\r\n        <Typography variant=\"subtitle1\" key=\"doc\" gutterBottom>{doc.presentation}</Typography>,\r\n        <List key=\"list\">\r\n          {Array.from(users.keys()).map(value => (\r\n            <ListItem\r\n              key={value.ref}\r\n              button\r\n              onClick={this.handleToggle(value)}\r\n            >\r\n              <Checkbox\r\n                checked={!!users.get(value)[doc.ref]}\r\n                tabIndex={-1}\r\n                disableRipple\r\n              />\r\n              <ListItemText primary={value.name} />\r\n            </ListItem>\r\n          ))}\r\n        </List>\r\n      ];\r\n\r\n  }\r\n}\r\n\r\nShare.propTypes = {\r\n  dialog: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default Share;\r\n","/**\r\n * ### Утилиты автономного режима\r\n * каркас компонента - визуальная глупая часть\r\n *\r\n */\r\n\r\nimport React, {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from 'metadata-react/App/Dialog';\r\nimport connect from './connect';\r\n\r\nimport Download from './Download';\r\nimport Inbox from './Inbox';\r\nimport Share from './Share';\r\n\r\nclass UtilsRouter extends Component {\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    const {handleCancel, handleCalck} = props;\r\n    this.handleCancel = handleCancel.bind(this);\r\n    this.handleCalck = handleCalck.bind(this);\r\n\r\n    this.state = {\r\n      info: null,\r\n      err: null,\r\n      title: 'Утилиты автономного режима',\r\n      Component: null,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    $p.adapters.pouch.remote.doc.info()\r\n      .then((info) => {\r\n        this.setState({info}, () => {\r\n          switch (this.props.dialog.cmd) {\r\n\r\n          case 'btn_download':\r\n            this.setState({Component: Download, title: 'Обновление заказов из облака'});\r\n            break;\r\n\r\n          case 'btn_share':\r\n            this.setState({Component: Share, title: 'Отправка заказа сотруднику'});\r\n            break;\r\n\r\n          case 'btn_inbox':\r\n            this.setState({Component: Inbox, title: 'Входящие заказы'});\r\n            break;\r\n\r\n          }\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({error: err.message || 'Ошибка доступа к базе doc'});\r\n      });\r\n  }\r\n\r\n  handleOk = () => {\r\n    this.handleCalck().then(this.handleCancel);\r\n  };\r\n\r\n  renderContent() {\r\n    const {err, info, Component} = this.state;\r\n\r\n    if(err) {\r\n      return <div>Сервер недоступен</div>;\r\n    }\r\n\r\n    if(!info) {\r\n      return <div>Проверка связи с сервером...</div>;\r\n    }\r\n\r\n    if(Component) {\r\n      return <Component {...this.props} handleCancel={this.handleCancel} />;\r\n    }\r\n\r\n    return <div>Подготовка данных...</div>;\r\n  }\r\n\r\n  render() {\r\n\r\n    const {handleCancel, state: {title}} = this;\r\n\r\n    return <Dialog\r\n      open\r\n      initFullScreen\r\n      large\r\n      title={title}\r\n      onClose={handleCancel}\r\n      actions={[\r\n        <Button key=\"cancel\" onClick={handleCancel} color=\"primary\">Закрыть</Button>\r\n      ]}\r\n    >\r\n      {this.renderContent()}\r\n    </Dialog>;\r\n\r\n  }\r\n}\r\n\r\nUtilsRouter.propTypes = {\r\n  dialog: PropTypes.object.isRequired,\r\n  handlers: PropTypes.object.isRequired,\r\n  handleCalck: PropTypes.func.isRequired,\r\n  handleCancel: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connect(UtilsRouter);\r\n","import UtilsRouter from './UtilsRouter';\r\n\r\nexport default UtilsRouter;\r\n"],"sourceRoot":""}