(this.webpackJsonpwindowbuilder=this.webpackJsonpwindowbuilder||[]).push([[14],{1042:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),l=a(1),r=a.n(l),h=a(552),i=a(353),o=(a(7),a(210)),c=a(629),d=a(572),m=a(93),p=a(74),u=Object(p.a)(e=>({hoveredItem:{backgroundColor:"#f5f2f2"},selectedItem:{backgroundColor:"#fffbdc"}})),_=a(20),g=a(268),f=a.n(g);class E extends h.a{constructor(e,t){super(e,t),this.handleSelect=()=>{const{state:{selectedRow:e},props:{handlers:t,_mgr:a}}=this;if(e){const n=this._list[e];n&&t.handleSelect&&t.handleSelect(n,a)}else this.handleInfoText("Не выбрана строка")},this.handleAdd=e=>{const{handlers:t,_mgr:a}=this.props;t.handleAdd&&t.handleAdd(a,e)},this.handleSchemeChange=e=>{e.set_default(),e.set_standard_period(!0),this.handleFilterChange(e,e.columns())},this.handleFilterChange=(e,t)=>{const{state:a,props:n,_list:s,_mounted:l}=this;e instanceof $p.CatScheme_settings||(e=a.scheme),t||(t=a.columns);const r={scheme:e,columns:t};l?this.setState(r,()=>{this._loadMoreRows()}):(Object.assign(a,r),this._loadMoreRows())},this.handlePrint=()=>{const e=this._list[this.state.selectedRow],{handlers:t,_mgr:a}=this.props;e&&t.handlePrint&&t.handlePrint(e,a)},this.handleAttachments=()=>{const e=this._list[this.state.selectedRow],{handlers:t,_mgr:a}=this.props;e&&t.handleAttachments&&t.handleAttachments(e,a)},this.handleSettingsOpen=()=>{this.setState({settings_open:!0})},this.handleSettingsClose=()=>{this.setState({settings_open:!1})},this.handleInfoText=e=>{"string"!==typeof e&&(e=""),this.setState({info_text:e})},this._getColumnWidth=({index:e})=>{const{columns:t}=this.state;return isNaN(parseInt(t[e].width,10))?E.COLUMN_DEFAULT_WIDTH:parseInt(t[e].width,10)},this._noContentRendered=()=>{const{no_rows:e}=this.state;return s.a.createElement(o.a,{text:e?"Записей не найдено...":""})},this._loadMoreRows=()=>{const{props:{_mgr:e,_owner:t,find_rows:a},state:{scheme:n,columns:s,ref:l},_list:r}=this;if(this.setState({no_rows:!1,network_error:null}),/ram$/.test(e.cachable)){const a=e.get_search_selector({_obj:t?t._obj||t.props&&t.props._obj:null,_meta:t?t._meta:{},search:n._search,top:1e3,skip:0}),s=e.find_rows(a);return Promise.resolve(s)}this.setState({network_error:"err"})},this.state={selectedRow:0,rowCount:0,settings_open:!1,no_rows:!1,ref:""},this._list=[],this.handleManagerChange(e)}handleManagerChange({_mgr:e,_meta:t,_ref:a}){const{class_name:n}=e;this._meta=t||e.metadata();const s={ref:a||""};this._mounted?this.setState(s):Object.assign(this.state,s),$p.cat.scheme_settings.get_scheme(n).then(this.handleSchemeChange)}get sizes(){let{context:{dnr:e},props:{width:t,height:a},state:{columns:n}}=this;a||(a=e&&parseInt(e.frameRect.height)-26),(!a||a<320)&&(a=320),t||(t=e&&parseInt(e.frameRect.width)),(!t||t<480)&&(t=480);const s=n&&n.reduce((e,t,a)=>e+this._getColumnWidth({index:a}),0);return s>t&&(t=s),{width:t,height:a}}get ltitle(){const{_mgr:e}=this.props;return(e.metadata().list_presentation||e.metadata().synonym)+" (дерево)"}render(){const{state:e,props:t,context:a,_meta:n,sizes:l,_list:r}=this,{columns:h,scheme:p,confirm_text:u,info_text:_,settings_open:g,rowCount:f}=e,{_mgr:{RepParams:E},classes:C,title:v,registerFilterChange:b,width:k,height:w,...y}=t;if(!p)return s.a.createElement(o.a,{text:"Чтение настроек компоновки..."});if(!h||!h.length)return s.a.createElement(o.a,{text:"Ошибка настроек компоновки..."});b&&b(this.handleFilterChange);const S=!g||l.height>572,x={key:"toolbar",scheme:p,...y,settings_open:g,handleSelect:this.handleSelect,handleAdd:this.handleAdd,handlePrint:this.handlePrint,handleAttachments:this.handleAttachments,handleSettingsOpen:this.handleSettingsOpen,handleSettingsClose:this.handleSettingsClose,handleSchemeChange:this.handleSchemeChange,handleFilterChange:this.handleFilterChange};return[u&&s.a.createElement(m.a,{key:"confirm",title:n.synonym,text:u,handleOk:this._handleRemove,handleCancel:()=>this.setState({confirm_text:""}),open:!0}),_&&s.a.createElement(m.a,{key:"confirm",title:n.synonym,text:_,handleOk:this.handleInfoText,handleCancel:this.handleInfoText,open:!0}),s.a.createElement(c.a,x),g&&s.a.createElement(i.a,{key:"tabs",disableHeight:!0},({width:e})=>s.a.createElement(d.a,{height:S?272:(l.height||500)-104,width:e,scheme:p,tabParams:E&&s.a.createElement(E,{scheme:p}),handleSchemeChange:this.handleSchemeChange})),S&&s.a.createElement(i.a,{key:"infinite",disableHeight:!0},({width:e})=>s.a.createElement("div",null,"tree"))]}_formatter(e,t){const{columns:a}=this.state,{id:n,type:s}=a[t],l=e[n];switch(f()(s,l)){case"ocombo":return this.props._mgr.value_mgr(e,n,s,!1,l).get(l).presentation;case"dhxCalendar":return $p.utils.moment(l).format($p.utils.moment._masks.date);case"calck":return l;default:return l?l.toString():""}}}E.COLUMN_DEFAULT_WIDTH=220,E.propTypes={_mgr:r.a.object.isRequired,_acl:r.a.string,_meta:r.a.object,_ref:r.a.string,_owner:r.a.object,selectionMode:r.a.bool,read_only:r.a.object,denyAddDel:r.a.bool,show_search:r.a.bool,show_variants:r.a.bool,modal:r.a.bool,handlers:r.a.object.isRequired};var C=u(Object(_.withIface)(E));t.default=C},554:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(a(0)),l=(0,n(a(13)).default)(s.default.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft");t.default=l},560:function(e,t,a){"use strict";var n=a(0),s=a.n(n),l=(a(1),a(158)),r=a(206),h=a(160),i=a(524),o=a(545),c=a.n(o),d=a(554),m=a.n(d);class p extends s.a.Component{constructor(...e){super(...e),this.state={anchorEl:null},this.handleOpen=e=>{this.setState({anchorEl:e.currentTarget})},this.handleClose=()=>{this.setState({anchorEl:null})}}render(){const{props:{items:e,Icon:t,text:a,handlePrint:n,prefix:o,variant:c},state:{anchorEl:d}}=this;return["button"===c?s.a.createElement(h.a,{key:"btn_open",onClick:this.handleOpen},s.a.createElement(t,null)):s.a.createElement(r.a,{key:o+"_open",onClick:this.handleOpen},t&&s.a.createElement(i.a,null,s.a.createElement(t,null)),a),s.a.createElement(l.a,{key:o+"_menu",open:Boolean(d),anchorEl:d,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},d&&e.map(e=>s.a.createElement(r.a,{key:e.ref,onClick:()=>{n(e),this.handleClose()}},e.name)))]}}class u extends p{constructor(...e){super(...e),this.state={anchorEl:null,plates:[]}}componentDidMount(){const{_mgr:e}=this.props.scheme.child_meta();e&&e.printing_plates().then(e=>{const t=new Map;for(const a in e){const n=e[a],s=n.name.includes("/")?n.name.substr(0,n.name.indexOf("/")).trim():"Общее";t.get(s)||t.set(s,[]),t.get(s).push(n)}e=[],t.forEach((t,a)=>e.push({name:a,value:t})),this.setState({plates:e})})}render(){const{props:{handlePrint:e,variant:t},state:{anchorEl:a,plates:n}}=this;return 1===n.length?s.a.createElement(p,{items:n[0].value,Icon:c.a,text:"Печать",handlePrint:e,prefix:"root",variant:t}):["button"===t?s.a.createElement(h.a,{key:"btn_open",onClick:this.handleOpen},s.a.createElement(c.a,null)):s.a.createElement(r.a,{key:"prn_open",onClick:this.handleOpen},s.a.createElement(i.a,null,s.a.createElement(c.a,null)),"Печать"),s.a.createElement(l.a,{key:"prn_menu",open:Boolean(a),anchorEl:a,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.handleClose},a&&n.map((t,a)=>s.a.createElement(p,{key:"prn_"+a,items:t.value,Icon:m.a,text:t.name,handlePrint:e,prefix:"prn_"+a})))]}}u.propTypes={},t.a=u},561:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(a(0)),l=(0,n(a(13)).default)(s.default.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}),"AttachFile");t.default=l},629:function(e,t,a){"use strict";var n=a(0),s=a.n(n),l=(a(1),a(447)),r=a(160),h=a(159),i=a(158),o=a(206),c=a(524),d=a(214),m=a.n(d),p=a(601),u=a.n(p),_=a(231),g=a.n(_),f=a(215),E=a.n(f),C=a(561),v=a.n(C),b=a(221),k=a.n(b),w=a(631),y=a.n(w),S=a(630),x=a.n(S),O=a(604),j=a(600),A=a(607),M=a(34),P=(a(7),a(86)),R=a(484),z=a(560);class I extends n.Component{constructor(...e){super(...e),this.state={anchorEl:void 0,open:!1},this.handleClick=e=>{this.setState({open:!0,anchorEl:e.currentTarget})},this.handleRequestClose=()=>{this.setState({open:!1})},this.handleSettingsToggle=()=>{const{props:e}=this;e.settings_open?e.handleSettingsClose():e.handleSettingsOpen(),this.handleRequestClose()}}render(){const{props:e,state:t}=this,{classes:a,scheme:n,width:d,btns:p,end_btns:_,menu_items:f,toolbar2row:C,flat:b,show_flat:w,setting_in_menu:S}=e,M=Object(R.c)("sm",d);return[s.a.createElement(l.a,{key:"toolbar1",disableGutters:!0,className:a.toolbar},e.selectionMode&&s.a.createElement(h.a,{key:"select",title:"Выбрать из списка",size:"small",variant:"outlined",className:a.spaceLeft,onClick:e.handleSelect},"Выбрать"),!e.denyAddDel&&s.a.createElement(r.a,{key:"create",title:"Создать объект",onClick:e.handleAdd},s.a.createElement(m.a,null)),s.a.createElement(r.a,{key:"edit",title:"Открыть форму объекта",onClick:e.handleEdit},s.a.createElement(g.a,null)),!e.denyAddDel&&!e.denyDel&&s.a.createElement(r.a,{key:"del",title:"Пометить на удаление",onClick:e.handleRemove},s.a.createElement(u.a,null)),w&&s.a.createElement(r.a,{key:"flat",title:b?"Включить иерархию":"Включить плоский список",onClick:e.flatChange},b?s.a.createElement(x.a,null):s.a.createElement(y.a,null)),!n.standard_period.empty()&&M&&s.a.createElement(r.a,{disabled:!0},"|"),!n.standard_period.empty()&&M&&s.a.createElement(A.a,{_obj:n,_fld:"date",_meta:{synonym:"Период"},classes:a,handleChange:e.handleFilterChange}),(!C||M)&&p,s.a.createElement("div",{className:a.flex}),s.a.createElement(O.a,{handleSettingsOpen:e.handleSettingsOpen,handleSettingsClose:e.handleSettingsClose,handleSchemeChange:e.handleSchemeChange,handleFilterChange:e.handleFilterChange,settings_open:e.settings_open,classes:a,scheme:n,show_search:e.show_search&&(!C||M),show_variants:e.show_variants,hide_btn:!M||S}),(!C||M)&&_,s.a.createElement(r.a,{onClick:this.handleClick,title:"Дополнительно"},s.a.createElement(E.a,null)),s.a.createElement(i.a,{anchorEl:t.anchorEl,open:t.open,onClose:this.handleRequestClose},(!M||S)&&s.a.createElement(o.a,{onClick:this.handleSettingsToggle},s.a.createElement(c.a,null,s.a.createElement(k.a,null)),"Настройки"),e.handlePrint&&s.a.createElement(z.a,{scheme:n,handlePrint:e.handlePrint}),e.handleAttachments&&s.a.createElement(o.a,{onClick:e.handleAttachments},s.a.createElement(c.a,null,s.a.createElement(v.a,null)),"Вложения"),f)),C&&!M&&s.a.createElement(l.a,{key:"toolbar2",disableGutters:!0,className:a.toolbar},p,s.a.createElement("div",{className:a.flex}),_,s.a.createElement(j.a,{scheme:n,handleFilterChange:e.handleFilterChange,isWidthUp:M}))]}}I.propTypes={},I.defaultProps={show_search:!0},t.a=Object(M.compose)(P.a,Object(R.a)())(I)},630:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(a(0)),l=(0,n(a(13)).default)(s.default.createElement("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"}),"List");t.default=l},631:function(e,t,a){"use strict";var n=a(12);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(a(0)),l=(0,n(a(13)).default)(s.default.createElement("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3z"}),"AccountTree");t.default=l}}]);
//# sourceMappingURL=14.f89a16ef.chunk.js.map